"use strict";let e,t,r,n,i,a,s,o,c,l,u,d,h,f,p,g;var m,v,y,_,b,w,S,k,x,z,E,I,T,O,A,$,D,P,C,N,j,R,U,M,L,B,Z,F,W,q,G,V,J,H,K,Y,X,Q,ee,et,er,en,ei,ea,es,eo,ec,el,eu,ed,eh,ef,ep,eg,em,ev,ey,e_,eb,ew,eS,ek,ex,ez,eE,eI,eT,eO,eA,e$,eD,eP,eC,eN,ej,eR,eU,eM=require("events"),eL=require("https"),eB=require("http"),eZ=require("net"),eF=require("tls"),eW=require("crypto"),eq=require("stream"),eG=require("url"),eV=require("zlib"),eJ=require("fs"),eH=require("path"),eK=require("os"),eY=require("buffer"),eX=require("node:fs"),eQ=require("node:path"),e0=require("node:process"),e1=require("node:crypto");class e4{events=new Map;addListener(e,t){return this.add(e,t,e=>e.push({listener:t}))}disposableOn(e,t){var r;let n,i;return this.add(e,t,e=>e.push({listener:t})),r=()=>this.removeListener(e,t),n=!1,{[Symbol.dispose]:i=()=>{n||(r(),n=!0)},dispose:i}}emit(e,...t){let r=this.events.get(e);if(void 0===r)return!1;for(let n=0;n<r.length;){let{listener:i,once:a}=r[n];a?this.remove(e,r,n):n++,i(...t)}return!0}eventNames(){return Array.from(this.events.keys())}listenerCount(e,t){let r=this.events.get(e);if(void 0===r||void 0==t)return r?.length||0;let n=0;return r.forEach(e=>{e.listener===t&&n++}),n}listeners(e){return Array.from(this.events.get(e)||[]).map(({listener:e})=>e)}off(e,t){let r=this.events.get(e)??[];for(let n=r.length-1;n>=0;n--)r[n].listener===t&&this.remove(e,r,n);return this}on(e,t){return this.add(e,t,e=>e.push({listener:t}))}once(e,t){return this.add(e,t,e=>e.push({listener:t,once:!0}))}prependListener(e,t){return this.add(e,t,e=>e.splice(0,0,{listener:t}))}prependOnceListener(e,t){return this.add(e,t,e=>e.splice(0,0,{listener:t,once:!0}))}removeAllListeners(e){let t=this.events.get(e)??[];for(;t.length>0;)this.remove(e,t,0);return this.events.delete(e),this}removeListener(e,t){return this.off(e,t)}add(e,t,r){let n=this.events.get(e);if(void 0===n&&(n=[],this.events.set(e,n)),r(n),"newListener"!==e){let r=[e,t];this.emit("newListener",...r)}return this}remove(e,t,r){let[{listener:n}]=t.splice(r,1);"removeListener"!==e&&this.emit("removeListener",e,n)}}class e2{#e;#t=new Map;#r;#n=new e4;constructor(e,t){this.#e=e,this.#r=t}get language(){return this.#e}set language(e){this.#e!==e&&(this.#e=e,this.#n.emit("languageChange",e))}onLanguageChange(e){return this.#n.disposableOn("languageChange",e)}t(e,t=this.language){return this.translate(e,t)}translate(e,t=this.language){for(let n of new Set([t,t.replaceAll("_","-").split("-").at(0),"en"])){var r;let t=(r=this.getTranslations(n),e.split(".").reduce((e,t)=>e&&e[t],r));if(t)return t.toString()}return e}getTranslations(e){let t=this.#t.get(e);return void 0===t&&(!function e(t){null==t||"object"!=typeof t||Object.isFrozen(t)||(Object.freeze(t),Object.values(t).forEach(e))}(t=this.#r(e)),this.#t.set(e,t)),t}}class e3{#i;#a;#s;constructor(e){e instanceof e3?(this.#i=e.#i,this.#a=e.#a):Array.isArray(e)?(this.#i=()=>e.values(),this.#a=()=>e.length):e instanceof Map||e instanceof Set?(this.#i=()=>e.values(),this.#a=()=>e.size):(this.#i=e,this.#a=()=>{let e=0;for(let t of this)e++;return e})}get length(){return this.#a()}*[Symbol.iterator](){for(let e of this.#i())yield e}asIndexedPairs(){return new e3((function*(){let e=0;for(let t of this)yield[e++,t]}).bind(this))}drop(e){if(isNaN(e)||e<0)throw RangeError("limit must be 0, or a positive number");return new e3((function*(){let t=0;for(let r of this)t++>=e&&(yield r)}).bind(this))}every(e){for(let t of this)if(!e(t))return!1;return!0}filter(e){return new e3((function*(){for(let t of this)e(t)&&(yield t)}).bind(this))}find(e){for(let t of this)if(e(t))return t}findLast(e){let t;for(let r of this)e(r)&&(t=r);return t}flatMap(e){return new e3((function*(){for(let t of this)for(let r of e(t))yield r}).bind(this))}forEach(e){for(let t of this)e(t)}includes(e){return this.some(t=>t===e)}map(e){return new e3((function*(){for(let t of this)yield e(t)}).bind(this))}next(...e){this.#s??=this.#i();let t=this.#s.next(...e);return t.done&&(this.#s=void 0),t}reduce(e,t){if(0===this.length){if(void 0===t)throw TypeError("Reduce of empty enumerable with no initial value.");return t}let r=t;for(let t of this)r=void 0===r?t:e(r,t);return r}return(e){return this.#s=void 0,{done:!0,value:e}}some(e){for(let t of this)if(e(t))return!0;return!1}take(e){if(isNaN(e)||e<0)throw RangeError("limit must be 0, or a positive number");return new e3((function*(){let t=0;for(let r of this)t++<e&&(yield r)}).bind(this))}throw(e){throw e}toArray(){return Array.from(this)}toJSON(){return this.toArray()}toString(){return`${this.toArray()}`}}Symbol.dispose??=Symbol("Symbol.dispose");class e9{#o=void 0;#c;constructor(e){this.#c=e}get value(){return void 0===this.#o&&(this.#o=this.#c()),this.#o}}function e6(){let e,t;return{promise:new Promise((r,n)=>{e=r,t=n}),resolve:e,reject:t}}var e5={exports:{}};function e8(){if(S)return w;S=1;let e=["nodebuffer","arraybuffer","fragments"],t="u">typeof Blob;return t&&e.push("blob"),w={BINARY_TYPES:e,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:t,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}}var e7={exports:{}};function te(e){throw Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var tt={exports:{}};function tr(){if(z)return tt.exports;z=1;let e="function"==typeof __webpack_require__?__non_webpack_require__:te;return"function"==typeof e.addon?tt.exports=e.addon.bind(e):tt.exports=function(){if(x)return k;x=1;var e="function"==typeof __webpack_require__?__non_webpack_require__:te,t=process.config&&process.config.variables||{},r=!!process.env.PREBUILDS_ONLY,n=process.versions.modules,i=process.versions&&process.versions.electron||process.env.ELECTRON_RUN_AS_NODE||"u">typeof window&&window.process&&"renderer"===window.process.type?"electron":process.versions&&process.versions.nw?"node-webkit":"node",a=process.env.npm_config_arch||eK.arch(),s=process.env.npm_config_platform||eK.platform(),o=process.env.LIBC||("linux"===s&&eJ.existsSync("/etc/alpine-release")?"musl":"glibc"),c=process.env.ARM_VERSION||("arm64"===a?"8":t.arm_version)||"",l=(process.versions.uv||"").split(".")[0];function u(t){return e(u.resolve(t))}function d(e){try{return eJ.readdirSync(e)}catch(e){return[]}}function h(e,t){var r=d(e).filter(t);return r[0]&&eH.join(e,r[0])}function f(e){return/\.node$/.test(e)}function p(e){var t=e.split("-");if(2===t.length){var r=t[0],n=t[1].split("+");if(r&&n.length&&n.every(Boolean))return{name:e,platform:r,architectures:n}}}function g(e,t){return function(r){return null!=r&&r.platform===e&&r.architectures.includes(t)}}function m(e,t){return e.architectures.length-t.architectures.length}function v(e){var t=e.split("."),r=t.pop(),n={file:e,specificity:0};if("node"===r){for(var i=0;i<t.length;i++){var a=t[i];if("node"===a||"electron"===a||"node-webkit"===a)n.runtime=a;else if("napi"===a)n.napi=!0;else if("abi"===a.slice(0,3))n.abi=a.slice(3);else if("uv"===a.slice(0,2))n.uv=a.slice(2);else if("armv"===a.slice(0,4))n.armv=a.slice(4);else{if("glibc"!==a&&"musl"!==a)continue;n.libc=a}n.specificity++}return n}}function y(e,t){return function(r){var n;return null!=r&&(!r.runtime||r.runtime===e||!!("node"===(n=r).runtime&&n.napi))&&(!r.abi||r.abi===t||!!r.napi)&&(!r.uv||r.uv===l)&&(!r.armv||r.armv===c)&&(!r.libc||r.libc===o)&&!0}}function _(e){return function(t,r){return t.runtime!==r.runtime?t.runtime===e?-1:1:t.abi!==r.abi?t.abi?-1:1:t.specificity!==r.specificity?t.specificity>r.specificity?-1:1:0}}return k=u,u.resolve=u.path=function(t){t=eH.resolve(t||".");try{var u=e(eH.join(t,"package.json")).name.toUpperCase().replace(/-/g,"_");process.env[u+"_PREBUILD"]&&(t=process.env[u+"_PREBUILD"])}catch(e){}if(!r){var b=h(eH.join(t,"build/Release"),f);if(b)return b;var w=h(eH.join(t,"build/Debug"),f);if(w)return w}var S=x(t);if(S)return S;var k=x(eH.dirname(process.execPath));if(k)return k;throw Error("No native build was found for "+["platform="+s,"arch="+a,"runtime="+i,"abi="+n,"uv="+l,c?"armv="+c:"","libc="+o,"node="+process.versions.node,process.versions.electron?"electron="+process.versions.electron:"","function"==typeof __webpack_require__?"webpack=true":""].filter(Boolean).join(" ")+"\n    loaded from: "+t+"\n");function x(e){var t=d(eH.join(e,"prebuilds")).map(p).filter(g(s,a)).sort(m)[0];if(t){var r=eH.join(e,"prebuilds",t.name),o=d(r).map(v).filter(y(i,n)).sort(_(i))[0];if(o)return eH.join(r,o.file)}}},u.parseTags=v,u.matchTags=y,u.compareTags=_,u.parseTuple=p,u.matchTuple=g,u.compareTuples=m,k}(),tt.exports}function tn(){if(O)return e5.exports;O=1;let{EMPTY_BUFFER:e}=e8(),t=Buffer[Symbol.species];function r(e,t,r,n,i){for(let a=0;a<i;a++)r[n+a]=e[a]^t[3&a]}function n(e,t){for(let r=0;r<e.length;r++)e[r]^=t[3&r]}function i(e){let r;return(i.readOnly=!0,Buffer.isBuffer(e))?e:(e instanceof ArrayBuffer?r=new t(e):ArrayBuffer.isView(e)?r=new t(e.buffer,e.byteOffset,e.byteLength):(r=Buffer.from(e),i.readOnly=!1),r)}if(e5.exports={concat:function(r,n){if(0===r.length)return e;if(1===r.length)return r[0];let i=Buffer.allocUnsafe(n),a=0;for(let e=0;e<r.length;e++){let t=r[e];i.set(t,a),a+=t.length}return a<n?new t(i.buffer,i.byteOffset,a):i},mask:r,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:i,unmask:n},!process.env.WS_NO_BUFFER_UTIL)try{let e=function(){if(T)return e7.exports;T=1;try{e7.exports=tr()(__dirname)}catch(e){e7.exports=I?E:(I=1,E={mask:(e,t,r,n,i)=>{for(var a=0;a<i;a++)r[n+a]=e[a]^t[3&a]},unmask:(e,t)=>{let r=e.length;for(var n=0;n<r;n++)e[n]^=t[3&n]}})}return e7.exports}();e5.exports.mask=function(t,n,i,a,s){s<48?r(t,n,i,a,s):e.mask(t,n,i,a,s)},e5.exports.unmask=function(t,r){t.length<32?n(t,r):e.unmask(t,r)}}catch(e){}return e5.exports}function ti(){let e;if(P)return D;P=1;let t=tn(),r=function(){if($)return A;$=1;let e=Symbol("kDone"),t=Symbol("kRun");return A=class{constructor(r){this[e]=()=>{this.pending--,this[t]()},this.concurrency=r||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[t]()}[t](){if(this.pending!==this.concurrency&&this.jobs.length){let t=this.jobs.shift();this.pending++,t(this[e])}}}}(),{kStatusCode:n}=e8(),i=Buffer[Symbol.species],a=Buffer.from([0,0,255,255]),s=Symbol("permessage-deflate"),o=Symbol("total-length"),c=Symbol("callback"),l=Symbol("buffers"),u=Symbol("error");function d(e){this[l].push(e),this[o]+=e.length}function h(e){(this[o]+=e.length,this[s]._maxPayload<1||this[o]<=this[s]._maxPayload)?this[l].push(e):(this[u]=RangeError("Max payload size exceeded"),this[u].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[u][n]=1009,this.removeListener("data",h),this.reset())}function f(e){(this[s]._inflate=null,this[u])?this[c](this[u]):(e[n]=1007,this[c](e))}return D=class{constructor(t,n,i){this._maxPayload=0|i,this._options=t||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!n,this._deflate=null,this._inflate=null,this.params=null,e||(e=new r(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[c];this._deflate.close(),this._deflate=null,e&&e(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,r=e.find(e=>(!1!==t.serverNoContextTakeover||!e.server_no_context_takeover)&&(!e.server_max_window_bits||!1!==t.serverMaxWindowBits&&("number"!=typeof t.serverMaxWindowBits||!(t.serverMaxWindowBits>e.server_max_window_bits)))&&("number"!=typeof t.clientMaxWindowBits||!!e.client_max_window_bits));if(!r)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:(!0===r.client_max_window_bits||!1===t.clientMaxWindowBits)&&delete r.client_max_window_bits,r}acceptAsClient(e){let t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let r=e[t];if(r.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(r=r[0],"client_max_window_bits"===t){if(!0!==r){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else if("server_max_window_bits"===t){let e=+r;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if("client_no_context_takeover"===t||"server_no_context_takeover"===t){if(!0!==r)throw TypeError(`Invalid value for parameter "${t}": ${r}`)}else throw Error(`Unknown parameter "${t}"`);e[t]=r})}),e}decompress(t,r,n){e.add(e=>{this._decompress(t,r,(t,r)=>{e(),n(t,r)})})}compress(t,r,n){e.add(e=>{this._compress(t,r,(t,r)=>{e(),n(t,r)})})}_decompress(e,r,n){let i=this._isServer?"client":"server";if(!this._inflate){let e=`${i}_max_window_bits`,t="number"!=typeof this.params[e]?eV.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=eV.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[s]=this,this._inflate[o]=0,this._inflate[l]=[],this._inflate.on("error",f),this._inflate.on("data",h)}this._inflate[c]=n,this._inflate.write(e),r&&this._inflate.write(a),this._inflate.flush(()=>{let e=this._inflate[u];if(e){this._inflate.close(),this._inflate=null,n(e);return}let a=t.concat(this._inflate[l],this._inflate[o]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[o]=0,this._inflate[l]=[],r&&this.params[`${i}_no_context_takeover`]&&this._inflate.reset()),n(null,a)})}_compress(e,r,n){let a=this._isServer?"server":"client";if(!this._deflate){let e=`${a}_max_window_bits`,t="number"!=typeof this.params[e]?eV.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=eV.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[o]=0,this._deflate[l]=[],this._deflate.on("data",d)}this._deflate[c]=n,this._deflate.write(e),this._deflate.flush(eV.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=t.concat(this._deflate[l],this._deflate[o]);r&&(e=new i(e.buffer,e.byteOffset,e.length-4)),this._deflate[c]=null,this._deflate[o]=0,this._deflate[l]=[],r&&this.params[`${a}_no_context_takeover`]&&this._deflate.reset(),n(null,e)})}}}var ta={exports:{}},ts={exports:{}};function to(){if(R)return ta.exports;R=1;let{isUtf8:e}=eY,{hasBlob:t}=e8();function r(e){let t=e.length,r=0;for(;r<t;)if((128&e[r])==0)r++;else if((224&e[r])==192){if(r+1===t||(192&e[r+1])!=128||(254&e[r])==192)return!1;r+=2}else if((240&e[r])==224){if(r+2>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||224===e[r]&&(224&e[r+1])==128||237===e[r]&&(224&e[r+1])==160)return!1;r+=3}else{if((248&e[r])!=240||r+3>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||(192&e[r+3])!=128||240===e[r]&&(240&e[r+1])==128||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0}if(ta.exports={isBlob:function(e){return t&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:r,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},e)ta.exports.isValidUTF8=function(t){return t.length<24?r(t):e(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let e=function(){if(j)return ts.exports;j=1;try{ts.exports=tr()(__dirname)}catch(e){ts.exports=N?C:(N=1,C=function(e){let t=e.length,r=0;for(;r<t;)if((128&e[r])==0)r++;else if((224&e[r])==192){if(r+1===t||(192&e[r+1])!=128||(254&e[r])==192)return!1;r+=2}else if((240&e[r])==224){if(r+2>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||224===e[r]&&(224&e[r+1])==128||237===e[r]&&(224&e[r+1])==160)return!1;r+=3}else{if((248&e[r])!=240||r+3>=t||(192&e[r+1])!=128||(192&e[r+2])!=128||(192&e[r+3])!=128||240===e[r]&&(240&e[r+1])==128||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0})}return ts.exports}();ta.exports.isValidUTF8=function(t){return t.length<32?r(t):e(t)}}catch(e){}return ta.exports}function tc(){if(M)return U;M=1;let{Writable:e}=eq,t=ti(),{BINARY_TYPES:r,EMPTY_BUFFER:n,kStatusCode:i,kWebSocket:a}=e8(),{concat:s,toArrayBuffer:o,unmask:c}=tn(),{isValidStatusCode:l,isValidUTF8:u}=to(),d=Buffer[Symbol.species];return U=class extends e{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||r[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[a]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let t=this._buffers[0];return this._buffers[0]=new d(t.buffer,t.byteOffset+e,t.length-e),new d(t.buffer,t.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let r=this._buffers[0],n=t.length-e;e>=r.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),n),this._buffers[0]=new d(r.buffer,r.byteOffset+e,r.length-e)),e-=r.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let r=this.consume(2);if((48&r[0])!=0)return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));let n=(64&r[0])==64;if(n&&!this._extensions[t.extensionName])return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._fin=(128&r[0])==128,this._opcode=15&r[0],this._payloadLength=127&r[1],0===this._opcode){if(n)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=n}else{if(!(this._opcode>7)||!(this._opcode<11))return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(n)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&r[1])==128,this._isServer){if(!this._masked)return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),r=t.readUInt32BE(0);r>2097151?e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=0x100000000*r+t.readUInt32BE(4),this.haveLength(e))}haveLength(e){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(e){let t=n;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&c(t,this._mask)}if(this._opcode>7)return void this.controlMessage(t,e);if(this._compressed){this._state=5,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,r){this._extensions[t.extensionName].decompress(e,this._fin,(e,t)=>{if(e)return r(e);if(t.length){if(this._messageLength+=t.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return void r(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(t)}this.dataMessage(r),0===this._state&&this.startLoop(r)})}dataMessage(e){if(!this._fin){this._state=0;return}let t=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let n;n="nodebuffer"===this._binaryType?s(r,t):"arraybuffer"===this._binaryType?o(s(r,t)):"blob"===this._binaryType?new Blob(r):r,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!0),this._state=0,this.startLoop(e)}))}else{let n=s(r,t);if(!this._skipUTF8Validation&&!u(n))return void e(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));5===this._state||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8===this._opcode){if(0===e.length)this._loop=!1,this.emit("conclude",1005,n),this.end();else{let r=e.readUInt16BE(0);if(!l(r))return void t(this.createError(RangeError,`invalid status code ${r}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));let n=new d(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!u(n))return void t(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));this._loop=!1,this.emit("conclude",r,n),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}))}createError(e,t,r,n,a){this._loop=!1,this._errored=!0;let s=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(s,this.createError),s.code=a,s[i]=n,s}}}function tl(){let e;if(B)return L;B=1;let{Duplex:t}=eq,{randomFillSync:r}=eW,n=ti(),{EMPTY_BUFFER:i,kWebSocket:a,NOOP:s}=e8(),{isBlob:o,isValidStatusCode:c}=to(),{mask:l,toBuffer:u}=tn(),d=Symbol("kByteLength"),h=Buffer.alloc(4),f=8192;class p{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=s,this[a]=void 0}static frame(t,n){let i,a,s=!1,o=2,c=!1;n.mask&&(i=n.maskBuffer||h,n.generateMask?n.generateMask(i):(8192===f&&(void 0===e&&(e=Buffer.alloc(8192)),r(e,0,8192),f=0),i[0]=e[f++],i[1]=e[f++],i[2]=e[f++],i[3]=e[f++]),c=(i[0]|i[1]|i[2]|i[3])==0,o=6),"string"==typeof t?a=(!n.mask||c)&&void 0!==n[d]?n[d]:(t=Buffer.from(t)).length:(a=t.length,s=n.mask&&n.readOnly&&!c);let u=a;a>=65536?(o+=8,u=127):a>125&&(o+=2,u=126);let p=Buffer.allocUnsafe(s?a+o:o);return(p[0]=n.fin?128|n.opcode:n.opcode,n.rsv1&&(p[0]|=64),p[1]=u,126===u?p.writeUInt16BE(a,2):127===u&&(p[2]=p[3]=0,p.writeUIntBE(a,4,6)),n.mask)?(p[1]|=128,p[o-4]=i[0],p[o-3]=i[1],p[o-2]=i[2],p[o-1]=i[3],c)?[p,t]:s?(l(t,i,p,o,a),[p]):(l(t,i,t,0,a),[p,t]):[p,t]}close(e,t,r,n){let a;if(void 0===e)a=i;else if("number"==typeof e&&c(e))if(void 0!==t&&t.length){let r=Buffer.byteLength(t);if(r>123)throw RangeError("The message must not be greater than 123 bytes");(a=Buffer.allocUnsafe(2+r)).writeUInt16BE(e,0),"string"==typeof t?a.write(t,2):a.set(t,2)}else(a=Buffer.allocUnsafe(2)).writeUInt16BE(e,0);else throw TypeError("First argument must be a valid error code number");let s={[d]:a.length,fin:!0,generateMask:this._generateMask,mask:r,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,a,!1,s,n]):this.sendFrame(p.frame(a,s),n)}ping(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):o(e)?(n=e.size,i=!1):(n=(e=u(e)).length,i=u.readOnly),n>125)throw RangeError("The data size must not be greater than 125 bytes");let a={[d]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};o(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,a,r]):this.getBlobData(e,!1,a,r):0!==this._state?this.enqueue([this.dispatch,e,!1,a,r]):this.sendFrame(p.frame(e,a),r)}pong(e,t,r){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):o(e)?(n=e.size,i=!1):(n=(e=u(e)).length,i=u.readOnly),n>125)throw RangeError("The data size must not be greater than 125 bytes");let a={[d]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};o(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,a,r]):this.getBlobData(e,!1,a,r):0!==this._state?this.enqueue([this.dispatch,e,!1,a,r]):this.sendFrame(p.frame(e,a),r)}send(e,t,r){let i,a,s=this._extensions[n.extensionName],c=t.binary?2:1,l=t.compress;"string"==typeof e?(i=Buffer.byteLength(e),a=!1):o(e)?(i=e.size,a=!1):(i=(e=u(e)).length,a=u.readOnly),this._firstFragment?(this._firstFragment=!1,l&&s&&s.params[s._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=i>=s._threshold),this._compress=l):(l=!1,c=0),t.fin&&(this._firstFragment=!0);let h={[d]:i,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:c,readOnly:a,rsv1:l};o(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,h,r]):this.getBlobData(e,this._compress,h,r):0!==this._state?this.enqueue([this.dispatch,e,this._compress,h,r]):this.dispatch(e,this._compress,h,r)}getBlobData(e,t,r,n){this._bufferedBytes+=r[d],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){let e=Error("The socket was closed while the blob was being read");process.nextTick(g,this,e,n);return}this._bufferedBytes-=r[d];let i=u(e);t?this.dispatch(i,t,r,n):(this._state=0,this.sendFrame(p.frame(i,r),n),this.dequeue())}).catch(e=>{process.nextTick(m,this,e,n)})}dispatch(e,t,r,i){if(!t)return void this.sendFrame(p.frame(e,r),i);let a=this._extensions[n.extensionName];this._bufferedBytes+=r[d],this._state=1,a.compress(e,r.fin,(e,t)=>{this._socket.destroyed?g(this,Error("The socket was closed while data was being compressed"),i):(this._bufferedBytes-=r[d],this._state=0,r.readOnly=!1,this.sendFrame(p.frame(t,r),i),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][d],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][d],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function g(e,t,r){"function"==typeof r&&r(t);for(let r=0;r<e._queue.length;r++){let n=e._queue[r],i=n[n.length-1];"function"==typeof i&&i(t)}}function m(e,t,r){g(e,t,r),e.onerror(t)}return L=p}function tu(){if(q)return W;q=1;let{tokenChars:e}=to();function t(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}return W={format:function(e){return Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>[t].concat(Object.keys(e).map(t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(r){let n,i,a=Object.create(null),s=Object.create(null),o=!1,c=!1,l=!1,u=-1,d=-1,h=-1,f=0;for(;f<r.length;f++)if(d=r.charCodeAt(f),void 0===n)if(-1===h&&1===e[d])-1===u&&(u=f);else if(0!==f&&(32===d||9===d))-1===h&&-1!==u&&(h=f);else if(59===d||44===d){if(-1===u)throw SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f);let e=r.slice(u,h);44===d?(t(a,e,s),s=Object.create(null)):n=e,u=h=-1}else throw SyntaxError(`Unexpected character at index ${f}`);else if(void 0===i)if(-1===h&&1===e[d])-1===u&&(u=f);else if(32===d||9===d)-1===h&&-1!==u&&(h=f);else if(59===d||44===d){if(-1===u)throw SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f),t(s,r.slice(u,h),!0),44===d&&(t(a,n,s),s=Object.create(null),n=void 0),u=h=-1}else if(61===d&&-1!==u&&-1===h)i=r.slice(u,f),u=h=-1;else throw SyntaxError(`Unexpected character at index ${f}`);else if(c){if(1!==e[d])throw SyntaxError(`Unexpected character at index ${f}`);-1===u?u=f:o||(o=!0),c=!1}else if(l)if(1===e[d])-1===u&&(u=f);else if(34===d&&-1!==u)l=!1,h=f;else if(92===d)c=!0;else throw SyntaxError(`Unexpected character at index ${f}`);else if(34===d&&61===r.charCodeAt(f-1))l=!0;else if(-1===h&&1===e[d])-1===u&&(u=f);else if(-1!==u&&(32===d||9===d))-1===h&&(h=f);else if(59===d||44===d){if(-1===u)throw SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f);let e=r.slice(u,h);o&&(e=e.replace(/\\/g,""),o=!1),t(s,i,e),44===d&&(t(a,n,s),s=Object.create(null),n=void 0),i=void 0,u=h=-1}else throw SyntaxError(`Unexpected character at index ${f}`);if(-1===u||l||32===d||9===d)throw SyntaxError("Unexpected end of input");-1===h&&(h=f);let p=r.slice(u,h);return void 0===n?t(a,p,s):(void 0===i?t(s,p,!0):o?t(s,i,p.replace(/\\/g,"")):t(s,i,p),t(a,n,s)),a}}}function td(){if(V)return G;V=1;let e=eM,{randomBytes:t,createHash:r}=eW,{Duplex:n,Readable:i}=eq,{URL:a}=eG,s=ti(),o=tc(),c=tl(),{isBlob:l}=to(),{BINARY_TYPES:u,CLOSE_TIMEOUT:d,EMPTY_BUFFER:h,GUID:f,kForOnEventAttribute:p,kListener:g,kStatusCode:m,kWebSocket:v,NOOP:y}=e8(),{EventTarget:{addEventListener:_,removeEventListener:b}}=function(){if(F)return Z;F=1;let{kForOnEventAttribute:e,kListener:t}=e8(),r=Symbol("kCode"),n=Symbol("kData"),i=Symbol("kError"),a=Symbol("kMessage"),s=Symbol("kReason"),o=Symbol("kTarget"),c=Symbol("kType"),l=Symbol("kWasClean");class u{constructor(e){this[o]=null,this[c]=e}get target(){return this[o]}get type(){return this[c]}}Object.defineProperty(u.prototype,"target",{enumerable:!0}),Object.defineProperty(u.prototype,"type",{enumerable:!0});class d extends u{constructor(e,t={}){super(e),this[r]=void 0===t.code?0:t.code,this[s]=void 0===t.reason?"":t.reason,this[l]=void 0!==t.wasClean&&t.wasClean}get code(){return this[r]}get reason(){return this[s]}get wasClean(){return this[l]}}Object.defineProperty(d.prototype,"code",{enumerable:!0}),Object.defineProperty(d.prototype,"reason",{enumerable:!0}),Object.defineProperty(d.prototype,"wasClean",{enumerable:!0});class h extends u{constructor(e,t={}){super(e),this[i]=void 0===t.error?null:t.error,this[a]=void 0===t.message?"":t.message}get error(){return this[i]}get message(){return this[a]}}Object.defineProperty(h.prototype,"error",{enumerable:!0}),Object.defineProperty(h.prototype,"message",{enumerable:!0});class f extends u{constructor(e,t={}){super(e),this[n]=void 0===t.data?null:t.data}get data(){return this[n]}}function p(e,t,r){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,r):e.call(t,r)}return Object.defineProperty(f.prototype,"data",{enumerable:!0}),Z={CloseEvent:d,ErrorEvent:h,Event:u,EventTarget:{addEventListener(r,n,i={}){let a;for(let a of this.listeners(r))if(!i[e]&&a[t]===n&&!a[e])return;if("message"===r)a=function(e,t){let r=new f("message",{data:t?e:e.toString()});r[o]=this,p(n,this,r)};else if("close"===r)a=function(e,t){let r=new d("close",{code:e,reason:t.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});r[o]=this,p(n,this,r)};else if("error"===r)a=function(e){let t=new h("error",{error:e,message:e.message});t[o]=this,p(n,this,t)};else{if("open"!==r)return;a=function(){let e=new u("open");e[o]=this,p(n,this,e)}}a[e]=!!i[e],a[t]=n,i.once?this.once(r,a):this.on(r,a)},removeEventListener(r,n){for(let i of this.listeners(r))if(i[t]===n&&!i[e]){this.removeListener(r,i);break}}},MessageEvent:f}}(),{format:w,parse:S}=tu(),{toBuffer:k}=tn(),x=Symbol("kAborted"),z=[8,13],E=["CONNECTING","OPEN","CLOSING","CLOSED"],I=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class T extends e{constructor(e,n,i){super(),this._binaryType=u[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=h,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=T.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===n?n=[]:Array.isArray(n)||("object"==typeof n&&null!==n?(i=n,n=[]):n=[n]),function e(n,i,o,c){let l,u,h,p,g={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:d,protocolVersion:z[1],maxPayload:0x6400000,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...c,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(n._autoPong=g.autoPong,n._closeTimeout=g.closeTimeout,!z.includes(g.protocolVersion))throw RangeError(`Unsupported protocol version: ${g.protocolVersion} (supported versions: ${z.join(", ")})`);if(i instanceof a)l=i;else try{l=new a(i)}catch(e){throw SyntaxError(`Invalid URL: ${i}`)}"http:"===l.protocol?l.protocol="ws:":"https:"===l.protocol&&(l.protocol="wss:"),n._url=l.href;let m="wss:"===l.protocol,v="ws+unix:"===l.protocol;if("ws:"===l.protocol||m||v?v&&!l.pathname?u="The URL's pathname is empty":l.hash&&(u="The URL contains a fragment identifier"):u='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',u){let e=SyntaxError(u);if(0!==n._redirects)return void O(n,e);throw e}let y=m?443:80,_=t(16).toString("base64"),b=m?eL.request:eB.request,k=new Set;if(g.createConnection=g.createConnection||(m?$:A),g.defaultPort=g.defaultPort||y,g.port=l.port||y,g.host=l.hostname.startsWith("[")?l.hostname.slice(1,-1):l.hostname,g.headers={...g.headers,"Sec-WebSocket-Version":g.protocolVersion,"Sec-WebSocket-Key":_,Connection:"Upgrade",Upgrade:"websocket"},g.path=l.pathname+l.search,g.timeout=g.handshakeTimeout,g.perMessageDeflate&&(h=new s(!0!==g.perMessageDeflate?g.perMessageDeflate:{},!1,g.maxPayload),g.headers["Sec-WebSocket-Extensions"]=w({[s.extensionName]:h.offer()})),o.length){for(let e of o){if("string"!=typeof e||!I.test(e)||k.has(e))throw SyntaxError("An invalid or duplicated subprotocol was specified");k.add(e)}g.headers["Sec-WebSocket-Protocol"]=o.join(",")}if(g.origin&&(g.protocolVersion<13?g.headers["Sec-WebSocket-Origin"]=g.origin:g.headers.Origin=g.origin),(l.username||l.password)&&(g.auth=`${l.username}:${l.password}`),v){let e=g.path.split(":");g.socketPath=e[0],g.path=e[1]}if(g.followRedirects){if(0===n._redirects){n._originalIpc=v,n._originalSecure=m,n._originalHostOrSocketPath=v?g.socketPath:l.host;let e=c&&c.headers;if(c={...c,headers:{}},e)for(let[t,r]of Object.entries(e))c.headers[t.toLowerCase()]=r}else if(0===n.listenerCount("redirect")){let e=v?!!n._originalIpc&&g.socketPath===n._originalHostOrSocketPath:!n._originalIpc&&l.host===n._originalHostOrSocketPath;e&&(!n._originalSecure||m)||(delete g.headers.authorization,delete g.headers.cookie,e||delete g.headers.host,g.auth=void 0)}g.auth&&!c.headers.authorization&&(c.headers.authorization="Basic "+Buffer.from(g.auth).toString("base64")),p=n._req=b(g),n._redirects&&n.emit("redirect",n.url,p)}else p=n._req=b(g);g.timeout&&p.on("timeout",()=>{D(n,p,"Opening handshake has timed out")}),p.on("error",e=>{null===p||p[x]||(p=n._req=null,O(n,e))}),p.on("response",t=>{let r=t.headers.location,s=t.statusCode;if(r&&g.followRedirects&&s>=300&&s<400){let t;if(++n._redirects>g.maxRedirects)return void D(n,p,"Maximum redirects exceeded");p.abort();try{t=new a(r,i)}catch(e){O(n,SyntaxError(`Invalid URL: ${r}`));return}e(n,t,o,c)}else n.emit("unexpected-response",p,t)||D(n,p,`Unexpected server response: ${t.statusCode}`)}),p.on("upgrade",(e,t,i)=>{let a;if(n.emit("upgrade",e),n.readyState!==T.CONNECTING)return;p=n._req=null;let o=e.headers.upgrade;if(void 0===o||"websocket"!==o.toLowerCase())return void D(n,t,"Invalid Upgrade header");let c=r("sha1").update(_+f).digest("base64");if(e.headers["sec-websocket-accept"]!==c)return void D(n,t,"Invalid Sec-WebSocket-Accept header");let l=e.headers["sec-websocket-protocol"];if(void 0!==l?k.size?k.has(l)||(a="Server sent an invalid subprotocol"):a="Server sent a subprotocol but none was requested":k.size&&(a="Server sent no subprotocol"),a)return void D(n,t,a);l&&(n._protocol=l);let u=e.headers["sec-websocket-extensions"];if(void 0!==u){let e;if(!h)return void D(n,t,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");try{e=S(u)}catch(e){D(n,t,"Invalid Sec-WebSocket-Extensions header");return}let r=Object.keys(e);if(1!==r.length||r[0]!==s.extensionName)return void D(n,t,"Server indicated an extension that was not requested");try{h.accept(e[s.extensionName])}catch(e){D(n,t,"Invalid Sec-WebSocket-Extensions header");return}n._extensions[s.extensionName]=h}n.setSocket(t,i,{allowSynchronousEvents:g.allowSynchronousEvents,generateMask:g.generateMask,maxPayload:g.maxPayload,skipUTF8Validation:g.skipUTF8Validation})}),g.finishRequest?g.finishRequest(p,n):p.end()}(this,e,n,i)):(this._autoPong=i.autoPong,this._closeTimeout=i.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){u.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){let n=new o({allowSynchronousEvents:r.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation}),i=new c(e,this._extensions,r.generateMask);this._receiver=n,this._sender=i,this._socket=e,n[v]=this,i[v]=this,e[v]=this,n.on("conclude",C),n.on("drain",N),n.on("error",j),n.on("message",U),n.on("ping",M),n.on("pong",L),i.onerror=W,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",J),e.on("data",H),e.on("end",K),e.on("error",Y),this._readyState=T.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=T.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[s.extensionName]&&this._extensions[s.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=T.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==T.CLOSED){if(this.readyState===T.CONNECTING)return void D(this,this._req,"WebSocket was closed before the connection was established");if(this.readyState===T.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=T.CLOSING,this._sender.close(e,t,!this._isServer,e=>{!e&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),q(this)}}pause(){this.readyState!==T.CONNECTING&&this.readyState!==T.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===T.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==T.OPEN)?P(this,e,r):(void 0===t&&(t=!this._isServer),this._sender.ping(e||h,t,r))}pong(e,t,r){if(this.readyState===T.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");("function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==T.OPEN)?P(this,e,r):(void 0===t&&(t=!this._isServer),this._sender.pong(e||h,t,r))}resume(){this.readyState!==T.CONNECTING&&this.readyState!==T.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===T.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(r=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==T.OPEN)return void P(this,e,r);let n={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[s.extensionName]||(n.compress=!1),this._sender.send(e||h,n,r)}terminate(){if(this.readyState!==T.CLOSED){if(this.readyState===T.CONNECTING)return void D(this,this._req,"WebSocket was closed before the connection was established");this._socket&&(this._readyState=T.CLOSING,this._socket.destroy())}}}function O(e,t){e._readyState=T.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function A(e){return e.path=e.socketPath,eZ.connect(e)}function $(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=eZ.isIP(e.host)?"":e.host),eF.connect(e)}function D(e,t,r){e._readyState=T.CLOSING;let n=Error(r);Error.captureStackTrace(n,D),t.setHeader?(t[x]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(O,e,n)):(t.destroy(n),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function P(e,t,r){if(t){let r=l(t)?t.size:k(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}if(r){let t=Error(`WebSocket is not open: readyState ${e.readyState} (${E[e.readyState]})`);process.nextTick(r,t)}}function C(e,t){let r=this[v];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,void 0!==r._socket[v]&&(r._socket.removeListener("data",H),process.nextTick(B,r._socket),1005===e?r.close():r.close(e,t))}function N(){let e=this[v];e.isPaused||e._socket.resume()}function j(e){let t=this[v];void 0!==t._socket[v]&&(t._socket.removeListener("data",H),process.nextTick(B,t._socket),t.close(e[m])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function R(){this[v].emitClose()}function U(e,t){this[v].emit("message",e,t)}function M(e){let t=this[v];t._autoPong&&t.pong(e,!this._isServer,y),t.emit("ping",e)}function L(e){this[v].emit("pong",e)}function B(e){e.resume()}function W(e){let t=this[v];t.readyState!==T.CLOSED&&(t.readyState===T.OPEN&&(t._readyState=T.CLOSING,q(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function q(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),e._closeTimeout)}function J(){let e=this[v];if(this.removeListener("close",J),this.removeListener("data",H),this.removeListener("end",K),e._readyState=T.CLOSING,!this._readableState.endEmitted&&!e._closeFrameReceived&&!e._receiver._writableState.errorEmitted&&0!==this._readableState.length){let t=this.read(this._readableState.length);e._receiver.write(t)}e._receiver.end(),this[v]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",R),e._receiver.on("finish",R))}function H(e){this[v]._receiver.write(e)||this.pause()}function K(){let e=this[v];e._readyState=T.CLOSING,e._receiver.end(),this.end()}function Y(){let e=this[v];this.removeListener("error",Y),this.on("error",y),e&&(e._readyState=T.CLOSING,this.destroy())}return Object.defineProperty(T,"CONNECTING",{enumerable:!0,value:E.indexOf("CONNECTING")}),Object.defineProperty(T.prototype,"CONNECTING",{enumerable:!0,value:E.indexOf("CONNECTING")}),Object.defineProperty(T,"OPEN",{enumerable:!0,value:E.indexOf("OPEN")}),Object.defineProperty(T.prototype,"OPEN",{enumerable:!0,value:E.indexOf("OPEN")}),Object.defineProperty(T,"CLOSING",{enumerable:!0,value:E.indexOf("CLOSING")}),Object.defineProperty(T.prototype,"CLOSING",{enumerable:!0,value:E.indexOf("CLOSING")}),Object.defineProperty(T,"CLOSED",{enumerable:!0,value:E.indexOf("CLOSED")}),Object.defineProperty(T.prototype,"CLOSED",{enumerable:!0,value:E.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(T.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(T.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[p])return t[g];return null},set(t){for(let t of this.listeners(e))if(t[p]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[p]:!0})}})}),T.prototype.addEventListener=_,T.prototype.removeEventListener=b,G=T}!function(){if(J)return;J=1,td();let{Duplex:e}=eq}(),tc(),tl();var th=(m=td())&&m.__esModule&&Object.prototype.hasOwnProperty.call(m,"default")?m.default:m;!function(){if(Y)return;Y=1;let{Duplex:e}=eq,{createHash:t}=eW,r=tu(),n=ti(),i=function(){if(K)return H;K=1;let{tokenChars:e}=to();return H={parse:function(t){let r=new Set,n=-1,i=-1,a=0;for(;a<t.length;a++){let s=t.charCodeAt(a);if(-1===i&&1===e[s])-1===n&&(n=a);else if(0!==a&&(32===s||9===s))-1===i&&-1!==n&&(i=a);else if(44===s){if(-1===n)throw SyntaxError(`Unexpected character at index ${a}`);-1===i&&(i=a);let e=t.slice(n,i);if(r.has(e))throw SyntaxError(`The "${e}" subprotocol is duplicated`);r.add(e),n=i=-1}else throw SyntaxError(`Unexpected character at index ${a}`)}if(-1===n||-1!==i)throw SyntaxError("Unexpected end of input");let s=t.slice(n,a);if(r.has(s))throw SyntaxError(`The "${s}" subprotocol is duplicated`);return r.add(s),r}}}(),a=td(),{CLOSE_TIMEOUT:s,GUID:o,kWebSocket:c}=e8()}(),(v=X||(X={}))[v.StreamDeck=0]="StreamDeck",v[v.StreamDeckMini=1]="StreamDeckMini",v[v.StreamDeckXL=2]="StreamDeckXL",v[v.StreamDeckMobile=3]="StreamDeckMobile",v[v.CorsairGKeys=4]="CorsairGKeys",v[v.StreamDeckPedal=5]="StreamDeckPedal",v[v.CorsairVoyager=6]="CorsairVoyager",v[v.StreamDeckPlus=7]="StreamDeckPlus",v[v.SCUFController=8]="SCUFController",v[v.StreamDeckNeo=9]="StreamDeckNeo",v[v.StreamDeckStudio=10]="StreamDeckStudio",v[v.VirtualStreamDeck=11]="VirtualStreamDeck",(y=Q||(Q={}))[y.Rectangle=0]="Rectangle",y[y.DoubleRectangle=1]="DoubleRectangle",y[y.Trapezoid=2]="Trapezoid",y[y.DoubleTrapezoid=3]="DoubleTrapezoid",y[y.Groove=4]="Groove",(_=ee||(ee={})).Port="-port",_.Info="-info",_.PluginUUID="-pluginUUID",_.RegisterEvent="-registerEvent",(b=et||(et={}))[b.HardwareAndSoftware=0]="HardwareAndSoftware",b[b.Hardware=1]="Hardware",b[b.Software=2]="Software";class tf{build;major;minor;patch;constructor(e){let t=e.match(/^(0|[1-9]\d*)(?:\.(0|[1-9]\d*))?(?:\.(0|[1-9]\d*))?(?:\.(0|[1-9]\d*))?$/);if(null===t)throw Error(`Invalid format; expected "{major}[.{minor}[.{patch}[.{build}]]]" but was "${e}"`);[,this.major,this.minor,this.patch,this.build]=[...t.map(e=>parseInt(e)||0)]}compareTo(e){let t=({major:e,minor:t,build:r,patch:n})=>[e,t,r,n],r=t(this),n=t(e);for(let e=0;e<4;e++)if(r[e]<n[e])return -1;else if(r[e]>n[e])return 1;return 0}toString(){return`${this.major}.${this.minor}`}}function tp(e){switch(e){case"error":return 0;case"warn":return 1;case"info":return 2;case"debug":return 3;default:return 4}}class tg{#l;#u;#d;constructor(e){this.#u={minimumLevel:"trace",...e},this.#d=void 0===this.#u.scope||""===this.#u.scope.trim()?"":this.#u.scope,"function"!=typeof this.#u.level&&this.setLevel(this.#u.level)}get level(){return void 0!==this.#l?this.#l:"function"==typeof this.#u.level?this.#u.level():this.#u.level}createScope(e){return""===(e=e.trim())?this:new tg({...this.#u,level:()=>this.level,scope:this.#u.scope?`${this.#u.scope}->${e}`:e})}debug(...e){return this.write({level:"debug",data:e,scope:this.#d})}error(...e){return this.write({level:"error",data:e,scope:this.#d})}info(...e){return this.write({level:"info",data:e,scope:this.#d})}setLevel(e){return void 0!==e&&tp(e)>tp(this.#u.minimumLevel)?this.#l="info":this.#l=e,this}trace(...e){return this.write({level:"trace",data:e,scope:this.#d})}warn(...e){return this.write({level:"warn",data:e,scope:this.#d})}write(e){return tp(e.level)<=tp(this.level)&&this.#u.targets.forEach(t=>t.write(e)),this}}function tm(){return void 0===f&&(f=process.execArgv.some(e=>{let t=e.split("=")[0];return"--inspect"===t||"--inspect-brk"===t||"--inspect-port"===t})),f}let tv=[new class{#h;#u;#f=0;constructor(e){this.#u=e,this.#h=this.getLogFilePath(),this.reIndex()}write(e){let t=eX.openSync(this.#h,"a");try{let r=this.#u.format(e);eX.writeSync(t,r+"\n"),this.#f+=r.length}finally{eX.closeSync(t)}this.#f>=this.#u.maxSize&&(this.reIndex(),this.#f=0)}getLogFilePath(e=0){return eQ.join(this.#u.dest,`${this.#u.fileName}.${e}.log`)}getLogFiles(){let e=/^\.(\d+)\.log$/;return eX.readdirSync(this.#u.dest,{withFileTypes:!0}).reduce((t,r)=>{if(r.isDirectory()||0>r.name.indexOf(this.#u.fileName))return t;let n=r.name.substring(this.#u.fileName.length).match(e);return n?.length!==2||t.push({path:eQ.join(this.#u.dest,r.name),index:parseInt(n[1])}),t},[]).sort(({index:e},{index:t})=>e<t?-1:+(e>t))}reIndex(){if(!eX.existsSync(this.#u.dest))return void eX.mkdirSync(this.#u.dest);let e=this.getLogFiles();for(let t=e.length-1;t>=0;t--){let r=e[t];t>=this.#u.maxFileCount-1?eX.rmSync(r.path):eX.renameSync(r.path,this.getLogFilePath(t+1))}}}({dest:eQ.join(e0.cwd(),"logs"),fileName:(g=(p=eQ.basename(process.cwd())).lastIndexOf(".sdPlugin"))<0?p:p.substring(0,g),format:e=>{let{data:t,level:r,scope:n}=e,i=`${new Date().toISOString()} ${r.toUpperCase().padEnd(5)} `;return n&&(i+=`${n}: `),`${i}${function(e){let t="",r=!1;for(let n of e){if("object"==typeof n&&n instanceof Error){t+=`
${n.stack}`,r=!0;continue}r&&(t+="\n",r=!1),t+="object"==typeof n?JSON.stringify(n):n,t+=" "}return t.trimEnd()}(t)}`},maxFileCount:10,maxSize:0x3200000})];tm()&&tv.splice(0,0,new class{write(e){switch(e.level){case"error":console.error(...e.data);break;case"warn":console.warn(...e.data);break;default:console.log(...e.data)}}});let ty=new tg({level:tm()?"debug":"info",minimumLevel:tm()?"trace":"debug",targets:tv});process.once("uncaughtException",e=>ty.error("Process encountered uncaught exception",e));class t_ extends e4{_registrationParameters;_version;canConnect=!0;connection=e6();logger=ty.createScope("Connection");get registrationParameters(){return this._registrationParameters??=this.getRegistrationParameters()}get version(){return this._version??=new tf(this.registrationParameters.info.application.version)}async connect(){if(this.canConnect){this.canConnect=!1;let e=new th(`ws://127.0.0.1:${this.registrationParameters.port}`);e.onmessage=e=>this.tryEmit(e),e.onopen=()=>{e.send(JSON.stringify({event:this.registrationParameters.registerEvent,uuid:this.registrationParameters.pluginUUID})),this.connection.resolve(e),this.emit("connected",this.registrationParameters.info)}}await this.connection.promise}async send(e){let t=await this.connection.promise,r=JSON.stringify(e);this.logger.trace(r),t.send(r)}getRegistrationParameters(){let e={port:void 0,info:void 0,pluginUUID:void 0,registerEvent:void 0},t=ty.createScope("RegistrationParameters");for(let r=0;r<process.argv.length-1;r++){let n=process.argv[r],i=process.argv[++r];switch(n){case ee.Port:t.debug(`port=${i}`),e.port=i;break;case ee.PluginUUID:t.debug(`pluginUUID=${i}`),e.pluginUUID=i;break;case ee.RegisterEvent:t.debug(`registerEvent=${i}`),e.registerEvent=i;break;case ee.Info:t.debug(`info=${i}`),e.info=JSON.parse(i);break;default:r--}}let r=[],n=(e,t)=>{void 0===t&&r.push(e)};if(n(ee.Port,e.port),n(ee.PluginUUID,e.pluginUUID),n(ee.RegisterEvent,e.registerEvent),n(ee.Info,e.info),r.length>0)throw Error(`Unable to establish a connection with Stream Deck, missing command line arguments: ${r.join(", ")}`);return e}tryEmit(e){try{let t=JSON.parse(e.data.toString());t.event?(this.logger.trace(e.data.toString()),this.emit(t.event,t)):this.logger.warn(`Received unknown message: ${e.data}`)}catch(t){this.logger.error(`Failed to parse message: ${e.data}`,t)}}}let tb=new t_;class tw{type;constructor(e){this.type=e.event}}class tS extends tw{action;constructor(e,t){super(t),this.action=e}}class tk extends tS{payload;constructor(e,t){super(e,t),this.payload=t.payload}}let tx=new e9(()=>{let e=eQ.join(process.cwd(),"manifest.json");if(!eX.existsSync(e))throw Error("Failed to read manifest.json as the file does not exist.");try{return JSON.parse(eX.readFileSync(e,{encoding:"utf-8",flag:"r"}).toString())}catch(e){if(e instanceof SyntaxError)return null;throw e}}),tz=new e9(()=>null===tx.value?null:new tf(tx.value.Software.MinimumVersion)),tE=new Map;class tI extends e3{constructor(){super(tE)}getActionById(e){return tE.get(e)}}let tT=new class extends tI{delete(e){tE.delete(e)}set(e){tE.set(e.id,e)}};class tO extends tw{application;constructor(e){super(e),this.application=e.payload.application}}class tA extends tw{device;constructor(e,t){super(e),this.device=t}}class t$ extends tw{url;constructor(e){super(e),this.url=new tP(e.payload.url)}}let tD="streamdeck://";class tP{fragment;href;path;query;queryParameters;constructor(e){let t=new URL(`${tD}${e}`);this.fragment=t.hash.substring(1),this.href=t.href.substring(tD.length),this.path=tP.parsePath(this.href),this.query=t.search.substring(1),this.queryParameters=t.searchParams}static parsePath(e){let t=t=>{let r=e.indexOf(t);return r>=0?r:e.length};return e.substring(0,Math.min(t("?"),t("#")))}}class tC extends tw{settings;constructor(e){super(e),this.settings=e.payload.settings}}class tN extends tw{action;payload;constructor(e,t){super(t),this.action=e,this.payload=t.payload}}function tj(e,t,r){let n={major:Math.floor(e),minor:Number(e.toString().split(".").at(1)??0),patch:0,build:0};if(-1===t.compareTo(n))throw Error(`[ERR_NOT_SUPPORTED]: ${r} requires Stream Deck version ${n.major}.${n.minor} or higher, but current version is ${t.major}.${t.minor}; please update Stream Deck and the "Software.MinimumVersion" in the plugin's manifest to "${n.major}.${n.minor}" or higher.`);let i=tz.value;if(null!==i&&-1===i.compareTo(n))throw Error(`[ERR_NOT_SUPPORTED]: ${r} requires Stream Deck version ${n.major}.${n.minor} or higher; please update the "Software.MinimumVersion" in the plugin's manifest to "${n.major}.${n.minor}" or higher.`)}let tR=!1,tU={get useExperimentalMessageIdentifiers(){return tR},set useExperimentalMessageIdentifiers(value){tj(7.1,tb.version,"Message identifiers"),tR=value},getGlobalSettings:()=>new Promise(e=>{tb.once("didReceiveGlobalSettings",t=>e(t.payload.settings)),tb.send({event:"getGlobalSettings",context:tb.registrationParameters.pluginUUID,id:e1.randomUUID()})}),onDidReceiveGlobalSettings:e=>tb.disposableOn("didReceiveGlobalSettings",t=>{tU.useExperimentalMessageIdentifiers&&t.id||e(new tC(t))}),onDidReceiveSettings:e=>tb.disposableOn("didReceiveSettings",t=>{if(tU.useExperimentalMessageIdentifiers&&t.id)return;let r=tT.getActionById(t.context);r&&e(new tk(r,t))}),setGlobalSettings:async e=>{await tb.send({event:"setGlobalSettings",context:tb.registrationParameters.pluginUUID,payload:e})}},tM=new class{#p;#g=0;constructor(){this.onDidAppear(e=>{this.#m(e.action)?this.#g++:(this.#g=1,this.#p=e.action)}),this.onDidDisappear(e=>{this.#m(e.action)&&(this.#g--,this.#g<=0&&(this.#p=void 0))})}get action(){return this.#p}onDidAppear(e){return tb.disposableOn("propertyInspectorDidAppear",t=>{let r=tT.getActionById(t.context);r&&e(new tS(r,t))})}onDidDisappear(e){return tb.disposableOn("propertyInspectorDidDisappear",t=>{let r=tT.getActionById(t.context);r&&e(new tS(r,t))})}onSendToPlugin(e){return tb.disposableOn("sendToPlugin",t=>{let r=tT.getActionById(t.context);r&&e(new tN(r,t))})}async sendToPropertyInspector(e){this.#p&&await tb.send({event:"sendToPropertyInspector",context:this.#p.id,payload:e})}#m(e){return this.#p?.id===e.id&&this.#p?.manifestId===e.manifestId&&this.#p?.device?.id===e.device.id}},tL=new Map;class tB extends e3{constructor(){super(tL)}getDeviceById(e){return tL.get(e)}}let tZ=new class extends tB{set(e){tL.set(e.id,e)}};class tF{#v;#y;constructor(e){this.#y=e;let t=tZ.getDeviceById(e.device);if(!t)throw Error(`Failed to initialize action; device ${e.device} not found`);this.#v=t}get controllerType(){return this.#y.payload.controller}get device(){return this.#v}get id(){return this.#y.context}get manifestId(){return this.#y.action}toJSON(){return{controllerType:this.controllerType,device:this.device,id:this.id,manifestId:this.manifestId}}}class tW extends tF{async getResources(){return tj(7.1,tb.version,"getResources"),(await this.#_("getResources","didReceiveResources")).payload.resources}async getSettings(){return(await this.#_("getSettings","didReceiveSettings")).payload.settings}isDial(){return"Encoder"===this.controllerType}isKey(){return"Keypad"===this.controllerType}setResources(e){return tj(7.1,tb.version,"setResources"),tb.send({event:"setResources",context:this.id,payload:e})}setSettings(e){return tb.send({event:"setSettings",context:this.id,payload:e})}showAlert(){return tb.send({event:"showAlert",context:this.id})}async #_(e,t){let{resolve:r,reject:n,promise:i}=e6(),a=setTimeout(()=>{s.dispose(),n("The request timed out")},15e3),s=tb.disposableOn(t,e=>{e.context==this.id&&(clearTimeout(a),s.dispose(),r(e))});return await tb.send({event:e,context:this.id,id:e1.randomUUID()}),i}}class tq extends tW{#b;constructor(e){if(super(e),"Encoder"!==e.payload.controller)throw Error("Unable to create DialAction; source event is not a Encoder");this.#b=Object.freeze(e.payload.coordinates)}get coordinates(){return this.#b}setFeedback(e){return tb.send({event:"setFeedback",context:this.id,payload:e})}setFeedbackLayout(e){return tb.send({event:"setFeedbackLayout",context:this.id,payload:{layout:e}})}setImage(e){return tb.send({event:"setImage",context:this.id,payload:{image:e}})}setTitle(e){return this.setFeedback({title:e})}setTriggerDescription(e){return tb.send({event:"setTriggerDescription",context:this.id,payload:e||{}})}toJSON(){return{...super.toJSON(),coordinates:this.coordinates}}}class tG extends tW{#b;#y;constructor(e){if(super(e),"Keypad"!==e.payload.controller)throw Error("Unable to create KeyAction; source event is not a Keypad");this.#b=e.payload.isInMultiAction?void 0:Object.freeze(e.payload.coordinates),this.#y=e}get coordinates(){return this.#b}isInMultiAction(){return this.#y.payload.isInMultiAction}setImage(e,t){return tb.send({event:"setImage",context:this.id,payload:{image:e,...t}})}setState(e){return tb.send({event:"setState",context:this.id,payload:{state:e}})}setTitle(e,t){return tb.send({event:"setTitle",context:this.id,payload:{title:e,...t}})}showOk(){return tb.send({event:"showOk",context:this.id})}toJSON(){return{...super.toJSON(),coordinates:this.coordinates,isInMultiAction:this.isInMultiAction()}}}let tV=new e9(()=>tx.value),tJ=new class extends tI{constructor(){super(),tb.prependListener("willAppear",e=>{let t="Encoder"===e.payload.controller?new tq(e):new tG(e);tT.set(t)}),tb.prependListener("willDisappear",e=>tT.delete(e.context))}onDialDown(e){return tb.disposableOn("dialDown",t=>{let r=tT.getActionById(t.context);r?.isDial()&&e(new tk(r,t))})}onDialRotate(e){return tb.disposableOn("dialRotate",t=>{let r=tT.getActionById(t.context);r?.isDial()&&e(new tk(r,t))})}onDialUp(e){return tb.disposableOn("dialUp",t=>{let r=tT.getActionById(t.context);r?.isDial()&&e(new tk(r,t))})}onDidReceiveResources(e){return tb.disposableOn("didReceiveResources",t=>{if(void 0!==t.id)return;let r=tT.getActionById(t.context);r&&e(new tk(r,t))})}onKeyDown(e){return tb.disposableOn("keyDown",t=>{let r=tT.getActionById(t.context);r?.isKey()&&e(new tk(r,t))})}onKeyUp(e){return tb.disposableOn("keyUp",t=>{let r=tT.getActionById(t.context);r?.isKey()&&e(new tk(r,t))})}onTitleParametersDidChange(e){return tb.disposableOn("titleParametersDidChange",t=>{let r=tT.getActionById(t.context);r&&e(new tk(r,t))})}onTouchTap(e){return tb.disposableOn("touchTap",t=>{let r=tT.getActionById(t.context);r?.isDial()&&e(new tk(r,t))})}onWillAppear(e){return tb.disposableOn("willAppear",t=>{let r=tT.getActionById(t.context);r&&e(new tk(r,t))})}onWillDisappear(e){return tb.disposableOn("willDisappear",t=>e(new tk(new tF(t),t)))}registerAction(e){if(void 0===e.manifestId)throw Error("The action's manifestId cannot be undefined.");if(null!==tV.value&&!tV.value.Actions.some(t=>t.UUID===e.manifestId))throw Error(`The action's manifestId was not found within the manifest: ${e.manifestId}`);let{manifestId:t}=e,r=(r,n)=>{let i=n?.bind(e);void 0!==i&&r.bind(e)(async e=>{e.action.manifestId==t&&await i(e)})};r(this.onDialDown,e.onDialDown),r(this.onDialUp,e.onDialUp),r(this.onDialRotate,e.onDialRotate),r(tM.onSendToPlugin,e.onSendToPlugin),r(this.onDidReceiveResources,e.onDidReceiveResources),r(tU.onDidReceiveSettings,e.onDidReceiveSettings),r(this.onKeyDown,e.onKeyDown),r(this.onKeyUp,e.onKeyUp),r(tM.onDidAppear,e.onPropertyInspectorDidAppear),r(tM.onDidDisappear,e.onPropertyInspectorDidDisappear),r(this.onTitleParametersDidChange,e.onTitleParametersDidChange),r(this.onTouchTap,e.onTouchTap),r(this.onWillAppear,e.onWillAppear),r(this.onWillDisappear,e.onWillDisappear)}};class tH{#w=!1;#S;id;constructor(e,t,r){this.id=e,this.#S=t,this.#w=r,tb.prependListener("deviceDidConnect",e=>{e.device===this.id&&(this.#S=e.deviceInfo,this.#w=!0)}),tb.prependListener("deviceDidChange",e=>{e.device===this.id&&(this.#S=e.deviceInfo)}),tb.prependListener("deviceDidDisconnect",e=>{e.device===this.id&&(this.#w=!1)})}get actions(){return tT.filter(e=>e.device.id===this.id)}get isConnected(){return this.#w}get name(){return this.#S.name}get size(){return this.#S.size}get type(){return this.#S.type}}let tK=new class extends tB{constructor(){super(),tb.once("connected",e=>{e.devices.forEach(e=>tZ.set(new tH(e.id,e,!1)))}),tb.on("deviceDidConnect",({device:e,deviceInfo:t})=>{tZ.getDeviceById(e)||tZ.set(new tH(e,t,!0))}),tb.on("deviceDidChange",({device:e,deviceInfo:t})=>{tZ.getDeviceById(e)||tZ.set(new tH(e,t,!1))})}onDeviceDidChange(e){return tj(7,tb.version,"onDeviceDidChange"),tb.disposableOn("deviceDidChange",t=>e(new tA(t,this.getDeviceById(t.device))))}onDeviceDidConnect(e){return tb.disposableOn("deviceDidConnect",t=>e(new tA(t,this.getDeviceById(t.device))))}onDeviceDidDisconnect(e){return tb.disposableOn("deviceDidDisconnect",t=>e(new tA(t,this.getDeviceById(t.device))))}};function tY(e){let t=eQ.join(process.cwd(),`${e}.json`);if(!eX.existsSync(t))return null;try{var r=eX.readFileSync(t,{flag:"r"})?.toString();let e=JSON.parse(r);if(null!=e&&"object"==typeof e&&"Localization"in e)return e.Localization;throw TypeError('Translations must be a JSON object nested under a property named "Localization"')}catch(e){return ty.error(`Failed to load translations from ${t}`,e),null}}var tX=Object.freeze({__proto__:null,switchToProfile:function(e,t,r){return void 0!==r&&tj(6.5,tb.version,"Switching to a profile page"),tb.send({event:"switchToProfile",context:tb.registrationParameters.pluginUUID,device:e,payload:{page:r,profile:t}})}}),tQ=Object.freeze({__proto__:null,getSecrets:function(){tj(6.9,tb.version,"Secrets");let e=tx.value?.SDKVersion??null;if(null!==e&&3>e)throw Error(`[ERR_NOT_SUPPORTED]: Secrets requires manifest SDK version 3 or higher, but found version ${e}; please update the "SDKVersion" in the plugin's manifest to 3 or higher.`);return new Promise(e=>{tb.once("didReceiveSecrets",t=>e(t.payload.secrets)),tb.send({event:"getSecrets",context:tb.registrationParameters.pluginUUID})})},onApplicationDidLaunch:function(e){return tb.disposableOn("applicationDidLaunch",t=>e(new tO(t)))},onApplicationDidTerminate:function(e){return tb.disposableOn("applicationDidTerminate",t=>e(new tO(t)))},onDidReceiveDeepLink:function(e){return tj(6.5,tb.version,"Receiving deep-link messages"),tb.disposableOn("didReceiveDeepLink",t=>e(new t$(t)))},onSystemDidWakeUp:function(e){return tb.disposableOn("systemDidWakeUp",t=>e(new tw(t)))},openUrl:function(e){return tb.send({event:"openUrl",payload:{url:e}})}});function t0(e){let t=e.UUID;return function(e,r){return class extends e{manifestId=t}}}class t1{manifestId;get actions(){return tT.filter(e=>e.manifestId===this.manifestId)}}let t4={get actions(){return tJ},get devices(){return tK},get i18n(){return e??=new e2(this.info.application.language,tY)},get info(){return tb.registrationParameters.info},get logger(){return ty},get profiles(){return tX},get settings(){return tU},get system(){return tQ},get ui(){return tM},connect:()=>tb.connect()};function t2(e,t,r){function n(r,n){if(r._zod||Object.defineProperty(r,"_zod",{value:{def:n,constr:s,traits:new Set},enumerable:!1}),r._zod.traits.has(e))return;r._zod.traits.add(e),t(r,n);let i=s.prototype,a=Object.keys(i);for(let e=0;e<a.length;e++){let t=a[e];t in r||(r[t]=i[t].bind(r))}}let i=r?.Parent??Object;class a extends i{}function s(e){var t;let i=r?.Parent?new a:this;for(let r of(n(i,e),(t=i._zod).deferred??(t.deferred=[]),i._zod.deferred))r();return i}return Object.defineProperty(a,"name",{value:e}),Object.defineProperty(s,"init",{value:n}),Object.defineProperty(s,Symbol.hasInstance,{value:t=>!!r?.Parent&&t instanceof r.Parent||t?._zod?.traits?.has(e)}),Object.defineProperty(s,"name",{value:e}),s}class t3 extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class t9 extends Error{constructor(e){super(`Encountered unidirectional transform during encode: ${e}`),this.name="ZodEncodeError"}}let t6={};function t5(e){let t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,r])=>-1===t.indexOf(+e)).map(([e,t])=>t)}function t8(e,t){return"bigint"==typeof t?t.toString():t}function t7(e){return{get value(){{let t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function re(e){let t=+!!e.startsWith("^"),r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}let rt=Symbol("evaluating");function rr(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==rt)return void 0===n&&(n=rt,n=r()),n},set(r){Object.defineProperty(e,t,{value:r})},configurable:!0})}function rn(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function ri(...e){let t={};for(let r of e)Object.assign(t,Object.getOwnPropertyDescriptors(r));return Object.defineProperties({},t)}function ra(e){return JSON.stringify(e)}let rs="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function ro(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}let rc=t7(()=>{if("u">typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return Function(""),!0}catch(e){return!1}});function rl(e){if(!1===ro(e))return!1;let t=e.constructor;if(void 0===t||"function"!=typeof t)return!0;let r=t.prototype;return!1!==ro(r)&&!1!==Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")}function ru(e){return rl(e)?{...e}:Array.isArray(e)?[...e]:e}let rd=new Set(["string","number","symbol"]);function rh(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function rf(e,t,r){let n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function rp(e){if(!e)return{};if("string"==typeof e)return{error:()=>e};if(e?.message!==void 0){if(e?.error!==void 0)throw Error("Cannot specify both `message` and `error` params");e.error=e.message}return(delete e.message,"string"==typeof e.error)?{...e,error:()=>e.error}:e}function rg(e,t=0){if(!0===e.aborted)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function rm(e,t){return t.map(t=>(t.path??(t.path=[]),t.path.unshift(e),t))}function rv(e){return"string"==typeof e?e:e?.message}function ry(e,t,r){let n={...e,path:e.path??[]};return e.message||(n.message=rv(e.inst?._zod.def?.error?.(e))??rv(t?.error?.(e))??rv(r.customError?.(e))??rv(r.localeError?.(e))??"Invalid input"),delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function r_(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"unknown"}function rb(...e){let[t,r,n]=e;return"string"==typeof t?{message:t,code:"custom",input:r,inst:n}:{...t}}let rw=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,t8,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},rS=t2("$ZodError",rw),rk=t2("$ZodError",rw,{Parent:Error}),rx=e=>(t,r,n,i)=>{let a=n?Object.assign(n,{async:!1}):{async:!1},s=t._zod.run({value:r,issues:[]},a);if(s instanceof Promise)throw new t3;if(s.issues.length){let t=new(i?.Err??e)(s.issues.map(e=>ry(e,a,t6)));throw rs(t,i?.callee),t}return s.value},rz=e=>async(t,r,n,i)=>{let a=n?Object.assign(n,{async:!0}):{async:!0},s=t._zod.run({value:r,issues:[]},a);if(s instanceof Promise&&(s=await s),s.issues.length){let t=new(i?.Err??e)(s.issues.map(e=>ry(e,a,t6)));throw rs(t,i?.callee),t}return s.value},rE=e=>(t,r,n)=>{let i=n?{...n,async:!1}:{async:!1},a=t._zod.run({value:r,issues:[]},i);if(a instanceof Promise)throw new t3;return a.issues.length?{success:!1,error:new(e??rS)(a.issues.map(e=>ry(e,i,t6)))}:{success:!0,data:a.value}},rI=rE(rk),rT=e=>async(t,r,n)=>{let i=n?Object.assign(n,{async:!0}):{async:!0},a=t._zod.run({value:r,issues:[]},i);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new e(a.issues.map(e=>ry(e,i,t6)))}:{success:!0,data:a.value}},rO=rT(rk),rA=/^[cC][^\s-]{8,}$/,r$=/^[0-9a-z]+$/,rD=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,rP=/^[0-9a-vA-V]{20}$/,rC=/^[A-Za-z0-9]{27}$/,rN=/^[a-zA-Z0-9_-]{21}$/,rj=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,rR=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,rU=e=>e?RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,rM=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,rL=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,rB=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,rZ=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,rF=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,rW=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,rq=/^[A-Za-z0-9_-]*$/,rG=/^\+[1-9]\d{6,14}$/,rV="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",rJ=RegExp(`^${rV}$`);function rH(e){let t="(?:[01]\\d|2[0-3]):[0-5]\\d";return"number"==typeof e.precision?-1===e.precision?`${t}`:0===e.precision?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}let rK=/^[^A-Z]*$/,rY=/^[^a-z]*$/,rX=t2("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),rQ=t2("$ZodCheckMaxLength",(e,t)=>{var r;rX.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return null!=t&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag.maximum??1/0;t.maximum<r&&(e._zod.bag.maximum=t.maximum)}),e._zod.check=r=>{let n=r.value;if(n.length<=t.maximum)return;let i=r_(n);r.issues.push({origin:i,code:"too_big",maximum:t.maximum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),r0=t2("$ZodCheckMinLength",(e,t)=>{var r;rX.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return null!=t&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag.minimum??-1/0;t.minimum>r&&(e._zod.bag.minimum=t.minimum)}),e._zod.check=r=>{let n=r.value;if(n.length>=t.minimum)return;let i=r_(n);r.issues.push({origin:i,code:"too_small",minimum:t.minimum,inclusive:!0,input:n,inst:e,continue:!t.abort})}}),r1=t2("$ZodCheckLengthEquals",(e,t)=>{var r;rX.init(e,t),(r=e._zod.def).when??(r.when=e=>{let t=e.value;return null!=t&&void 0!==t.length}),e._zod.onattach.push(e=>{let r=e._zod.bag;r.minimum=t.length,r.maximum=t.length,r.length=t.length}),e._zod.check=r=>{let n=r.value,i=n.length;if(i===t.length)return;let a=r_(n),s=i>t.length;r.issues.push({origin:a,...s?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:r.value,inst:e,continue:!t.abort})}}),r4=t2("$ZodCheckStringFormat",(e,t)=>{var r,n;rX.init(e,t),e._zod.onattach.push(e=>{let r=e._zod.bag;r.format=t.format,t.pattern&&(r.patterns??(r.patterns=new Set),r.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:t.format,input:r.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),r2=t2("$ZodCheckRegex",(e,t)=>{r4.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,t.pattern.test(r.value)||r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),r3=t2("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=rK),r4.init(e,t)}),r9=t2("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=rY),r4.init(e,t)}),r6=t2("$ZodCheckIncludes",(e,t)=>{rX.init(e,t);let r=rh(t.includes),n=new RegExp("number"==typeof t.position?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(n)}),e._zod.check=r=>{r.value.includes(t.includes,t.position)||r.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:r.value,inst:e,continue:!t.abort})}}),r5=t2("$ZodCheckStartsWith",(e,t)=>{rX.init(e,t);let r=RegExp(`^${rh(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.startsWith(t.prefix)||r.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:r.value,inst:e,continue:!t.abort})}}),r8=t2("$ZodCheckEndsWith",(e,t)=>{rX.init(e,t);let r=RegExp(`.*${rh(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(e=>{let t=e._zod.bag;t.patterns??(t.patterns=new Set),t.patterns.add(r)}),e._zod.check=r=>{r.value.endsWith(t.suffix)||r.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:r.value,inst:e,continue:!t.abort})}}),r7=t2("$ZodCheckOverwrite",(e,t)=>{rX.init(e,t),e._zod.check=e=>{e.value=t.tx(e.value)}});class ne{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e){e(this,{execution:"sync"}),e(this,{execution:"async"});return}let t=e.split("\n").filter(e=>e),r=Math.min(...t.map(e=>e.length-e.trimStart().length));for(let e of t.map(e=>e.slice(r)).map(e=>" ".repeat(2*this.indent)+e))this.content.push(e)}compile(){return Function(...this?.args,[...(this?.content??[""]).map(e=>`  ${e}`)].join("\n"))}}let nt={major:4,minor:3,patch:6},nr=t2("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=nt;let n=[...e._zod.def.checks??[]];for(let t of(e._zod.traits.has("$ZodCheck")&&n.unshift(e),n))for(let r of t._zod.onattach)r(e);if(0===n.length)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{let t=(e,t,r)=>{let n,i=rg(e);for(let a of t){if(a._zod.def.when){if(!a._zod.def.when(e))continue}else if(i)continue;let t=e.issues.length,s=a._zod.check(e);if(s instanceof Promise&&r?.async===!1)throw new t3;if(n||s instanceof Promise)n=(n??Promise.resolve()).then(async()=>{await s,e.issues.length!==t&&(i||(i=rg(e,t)))});else{if(e.issues.length===t)continue;i||(i=rg(e,t))}}return n?n.then(()=>e):e},r=(r,i,a)=>{if(rg(r))return r.aborted=!0,r;let s=t(i,n,a);if(s instanceof Promise){if(!1===a.async)throw new t3;return s.then(t=>e._zod.parse(t,a))}return e._zod.parse(s,a)};e._zod.run=(i,a)=>{if(a.skipChecks)return e._zod.parse(i,a);if("backward"===a.direction){let t=e._zod.parse({value:i.value,issues:[]},{...a,skipChecks:!0});return t instanceof Promise?t.then(e=>r(e,i,a)):r(t,i,a)}let s=e._zod.parse(i,a);if(s instanceof Promise){if(!1===a.async)throw new t3;return s.then(e=>t(e,n,a))}return t(s,n,a)}}rr(e,"~standard",()=>({validate:t=>{try{let r=rI(e,t);return r.success?{value:r.data}:{issues:r.error?.issues}}catch(r){return rO(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}))}),nn=t2("$ZodString",(e,t)=>{var r;let n;nr.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??(n=(r=e._zod.bag)?`[\\s\\S]{${r?.minimum??0},${r?.maximum??""}}`:"[\\s\\S]*",RegExp(`^${n}$`)),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch(e){}return"string"==typeof r.value||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),ni=t2("$ZodStringFormat",(e,t)=>{r4.init(e,t),nn.init(e,t)}),na=t2("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=rR),ni.init(e,t)}),ns=t2("$ZodUUID",(e,t)=>{if(t.version){let e={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(void 0===e)throw Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=rU(e))}else t.pattern??(t.pattern=rU());ni.init(e,t)}),no=t2("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=rM),ni.init(e,t)}),nc=t2("$ZodURL",(e,t)=>{ni.init(e,t),e._zod.check=r=>{try{let n=r.value.trim(),i=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(i.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:t.hostname.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(i.protocol.endsWith(":")?i.protocol.slice(0,-1):i.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=i.href:r.value=n;return}catch(n){r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),nl=t2("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ni.init(e,t)}),nu=t2("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=rN),ni.init(e,t)}),nd=t2("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=rA),ni.init(e,t)}),nh=t2("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=r$),ni.init(e,t)}),nf=t2("$ZodULID",(e,t)=>{t.pattern??(t.pattern=rD),ni.init(e,t)}),np=t2("$ZodXID",(e,t)=>{t.pattern??(t.pattern=rP),ni.init(e,t)}),ng=t2("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=rC),ni.init(e,t)}),nm=t2("$ZodISODateTime",(e,t)=>{let r,n,i;t.pattern??(r=rH({precision:t.precision}),n=["Z"],t.local&&n.push(""),t.offset&&n.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)"),i=`${r}(?:${n.join("|")})`,t.pattern=RegExp(`^${rV}T(?:${i})$`)),ni.init(e,t)}),nv=t2("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=rJ),ni.init(e,t)}),ny=t2("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=RegExp(`^${rH(t)}$`)),ni.init(e,t)}),n_=t2("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=rj),ni.init(e,t)}),nb=t2("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=rL),ni.init(e,t),e._zod.bag.format="ipv4"}),nw=t2("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=rB),ni.init(e,t),e._zod.bag.format="ipv6",e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),nS=t2("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=rZ),ni.init(e,t)}),nk=t2("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=rF),ni.init(e,t),e._zod.check=r=>{let n=r.value.split("/");try{if(2!==n.length)throw Error();let[e,t]=n;if(!t)throw Error();let r=Number(t);if(`${r}`!==t||r<0||r>128)throw Error();new URL(`http://[${e}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function nx(e){if(""===e)return!0;if(e.length%4!=0)return!1;try{return atob(e),!0}catch{return!1}}let nz=t2("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=rW),ni.init(e,t),e._zod.bag.contentEncoding="base64",e._zod.check=r=>{nx(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}}),nE=t2("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=rq),ni.init(e,t),e._zod.bag.contentEncoding="base64url",e._zod.check=r=>{!function(e){if(!rq.test(e))return!1;let t=e.replace(/[-_]/g,e=>"-"===e?"+":"/");return nx(t.padEnd(4*Math.ceil(t.length/4),"="))}(r.value)&&r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),nI=t2("$ZodE164",(e,t)=>{t.pattern??(t.pattern=rG),ni.init(e,t)}),nT=t2("$ZodJWT",(e,t)=>{ni.init(e,t),e._zod.check=r=>{!function(e,t=null){try{let r=e.split(".");if(3!==r.length)return!1;let[n]=r;if(!n)return!1;let i=JSON.parse(atob(n));if("typ"in i&&i?.typ!=="JWT"||!i.alg||t&&(!("alg"in i)||i.alg!==t))return!1;return!0}catch{return!1}}(r.value,t.alg)&&r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),nO=t2("$ZodUnknown",(e,t)=>{nr.init(e,t),e._zod.parse=e=>e}),nA=t2("$ZodNever",(e,t)=>{nr.init(e,t),e._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)});function n$(e,t,r){e.issues.length&&t.issues.push(...rm(r,e.issues)),t.value[r]=e.value}let nD=t2("$ZodArray",(e,t)=>{nr.init(e,t),e._zod.parse=(r,n)=>{let i=r.value;if(!Array.isArray(i))return r.issues.push({expected:"array",code:"invalid_type",input:i,inst:e}),r;r.value=Array(i.length);let a=[];for(let e=0;e<i.length;e++){let s=i[e],o=t.element._zod.run({value:s,issues:[]},n);o instanceof Promise?a.push(o.then(t=>n$(t,r,e))):n$(o,r,e)}return a.length?Promise.all(a).then(()=>r):r}});function nP(e,t,r,n,i){if(e.issues.length){if(i&&!(r in n))return;t.issues.push(...rm(r,e.issues))}void 0===e.value?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function nC(e){var t;let r=Object.keys(e.shape);for(let t of r)if(!e.shape?.[t]?._zod?.traits?.has("$ZodType"))throw Error(`Invalid element at key "${t}": expected a Zod schema`);let n=Object.keys(t=e.shape).filter(e=>"optional"===t[e]._zod.optin&&"optional"===t[e]._zod.optout);return{...e,keys:r,keySet:new Set(r),numKeys:r.length,optionalKeys:new Set(n)}}function nN(e,t,r,n,i,a){let s=[],o=i.keySet,c=i.catchall._zod,l=c.def.type,u="optional"===c.optout;for(let i in t){if(o.has(i))continue;if("never"===l){s.push(i);continue}let a=c.run({value:t[i],issues:[]},n);a instanceof Promise?e.push(a.then(e=>nP(e,r,i,t,u))):nP(a,r,i,t,u)}return(s.length&&r.issues.push({code:"unrecognized_keys",keys:s,input:t,inst:a}),e.length)?Promise.all(e).then(()=>r):r}let nj=t2("$ZodObject",(e,t)=>{let r;nr.init(e,t);let n=Object.getOwnPropertyDescriptor(t,"shape");if(!n?.get){let e=t.shape;Object.defineProperty(t,"shape",{get:()=>{let r={...e};return Object.defineProperty(t,"shape",{value:r}),r}})}let i=t7(()=>nC(t));rr(e._zod,"propValues",()=>{let e=t.shape,r={};for(let t in e){let n=e[t]._zod;if(n.values)for(let e of(r[t]??(r[t]=new Set),n.values))r[t].add(e)}return r});let a=t.catchall;e._zod.parse=(t,n)=>{r??(r=i.value);let s=t.value;if(!ro(s))return t.issues.push({expected:"object",code:"invalid_type",input:s,inst:e}),t;t.value={};let o=[],c=r.shape;for(let e of r.keys){let r=c[e],i="optional"===r._zod.optout,a=r._zod.run({value:s[e],issues:[]},n);a instanceof Promise?o.push(a.then(r=>nP(r,t,e,s,i))):nP(a,t,e,s,i)}return a?nN(o,s,t,n,i.value,e):o.length?Promise.all(o).then(()=>t):t}}),nR=t2("$ZodObjectJIT",(e,t)=>{let r,n;nj.init(e,t);let i=e._zod.parse,a=t7(()=>nC(t)),s=!t6.jitless,o=s&&rc.value,c=t.catchall;e._zod.parse=(l,u)=>{n??(n=a.value);let d=l.value;return ro(d)?s&&o&&u?.async===!1&&!0!==u.jitless?(r||(r=(e=>{let t=new ne(["shape","payload","ctx"]),r=a.value,n=e=>{let t=ra(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");let i=Object.create(null),s=0;for(let e of r.keys)i[e]=`key_${s++}`;for(let a of(t.write("const newResult = {};"),r.keys)){let r=i[a],s=ra(a),o=e[a],c=o?._zod?.optout==="optional";t.write(`const ${r} = ${n(a)};`),c?t.write(`
        if (${r}.issues.length) {
          if (${s} in input) {
            payload.issues = payload.issues.concat(${r}.issues.map(iss => ({
              ...iss,
              path: iss.path ? [${s}, ...iss.path] : [${s}]
            })));
          }
        }
        
        if (${r}.value === undefined) {
          if (${s} in input) {
            newResult[${s}] = undefined;
          }
        } else {
          newResult[${s}] = ${r}.value;
        }
        
      `):t.write(`
        if (${r}.issues.length) {
          payload.issues = payload.issues.concat(${r}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${s}, ...iss.path] : [${s}]
          })));
        }
        
        if (${r}.value === undefined) {
          if (${s} in input) {
            newResult[${s}] = undefined;
          }
        } else {
          newResult[${s}] = ${r}.value;
        }
        
      `)}t.write("payload.value = newResult;"),t.write("return payload;");let o=t.compile();return(t,r)=>o(e,t,r)})(t.shape)),l=r(l,u),c)?nN([],d,l,u,n,e):l:i(l,u):(l.issues.push({expected:"object",code:"invalid_type",input:d,inst:e}),l)}});function nU(e,t,r,n){for(let r of e)if(0===r.issues.length)return t.value=r.value,t;let i=e.filter(e=>!rg(e));return 1===i.length?(t.value=i[0].value,i[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(e=>e.issues.map(e=>ry(e,n,t6)))}),t)}let nM=t2("$ZodUnion",(e,t)=>{nr.init(e,t),rr(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),rr(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),rr(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),rr(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){let e=t.options.map(e=>e._zod.pattern);return RegExp(`^(${e.map(e=>re(e.source)).join("|")})$`)}});let r=1===t.options.length,n=t.options[0]._zod.run;e._zod.parse=(i,a)=>{if(r)return n(i,a);let s=!1,o=[];for(let e of t.options){let t=e._zod.run({value:i.value,issues:[]},a);if(t instanceof Promise)o.push(t),s=!0;else{if(0===t.issues.length)return t;o.push(t)}}return s?Promise.all(o).then(t=>nU(t,i,e,a)):nU(o,i,e,a)}}),nL=t2("$ZodIntersection",(e,t)=>{nr.init(e,t),e._zod.parse=(e,r)=>{let n=e.value,i=t.left._zod.run({value:n,issues:[]},r),a=t.right._zod.run({value:n,issues:[]},r);return i instanceof Promise||a instanceof Promise?Promise.all([i,a]).then(([t,r])=>nB(e,t,r)):nB(e,i,a)}});function nB(e,t,r){let n,i=new Map;for(let r of t.issues)if("unrecognized_keys"===r.code)for(let e of(n??(n=r),r.keys))i.has(e)||i.set(e,{}),i.get(e).l=!0;else e.issues.push(r);for(let t of r.issues)if("unrecognized_keys"===t.code)for(let e of t.keys)i.has(e)||i.set(e,{}),i.get(e).r=!0;else e.issues.push(t);let a=[...i].filter(([,e])=>e.l&&e.r).map(([e])=>e);if(a.length&&n&&e.issues.push({...n,keys:a}),rg(e))return e;let s=function e(t,r){if(t===r||t instanceof Date&&r instanceof Date&&+t==+r)return{valid:!0,data:t};if(rl(t)&&rl(r)){let n=Object.keys(r),i=Object.keys(t).filter(e=>-1!==n.indexOf(e)),a={...t,...r};for(let n of i){let i=e(t[n],r[n]);if(!i.valid)return{valid:!1,mergeErrorPath:[n,...i.mergeErrorPath]};a[n]=i.data}return{valid:!0,data:a}}if(Array.isArray(t)&&Array.isArray(r)){if(t.length!==r.length)return{valid:!1,mergeErrorPath:[]};let n=[];for(let i=0;i<t.length;i++){let a=e(t[i],r[i]);if(!a.valid)return{valid:!1,mergeErrorPath:[i,...a.mergeErrorPath]};n.push(a.data)}return{valid:!0,data:n}}return{valid:!1,mergeErrorPath:[]}}(t.value,r.value);if(!s.valid)throw Error(`Unmergable intersection. Error path: ${JSON.stringify(s.mergeErrorPath)}`);return e.value=s.data,e}let nZ=t2("$ZodEnum",(e,t)=>{nr.init(e,t);let r=t5(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=RegExp(`^(${r.filter(e=>rd.has(typeof e)).map(e=>"string"==typeof e?rh(e):e.toString()).join("|")})$`),e._zod.parse=(t,i)=>{let a=t.value;return n.has(a)||t.issues.push({code:"invalid_value",values:r,input:a,inst:e}),t}}),nF=t2("$ZodTransform",(e,t)=>{nr.init(e,t),e._zod.parse=(r,n)=>{if("backward"===n.direction)throw new t9(e.constructor.name);let i=t.transform(r.value,r);if(n.async)return(i instanceof Promise?i:Promise.resolve(i)).then(e=>(r.value=e,r));if(i instanceof Promise)throw new t3;return r.value=i,r}});function nW(e,t){return e.issues.length&&void 0===t?{issues:[],value:void 0}:e}let nq=t2("$ZodOptional",(e,t)=>{nr.init(e,t),e._zod.optin="optional",e._zod.optout="optional",rr(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),rr(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${re(e.source)})?$`):void 0}),e._zod.parse=(e,r)=>{if("optional"===t.innerType._zod.optin){let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(t=>nW(t,e.value)):nW(n,e.value)}return void 0===e.value?e:t.innerType._zod.run(e,r)}}),nG=t2("$ZodExactOptional",(e,t)=>{nq.init(e,t),rr(e._zod,"values",()=>t.innerType._zod.values),rr(e._zod,"pattern",()=>t.innerType._zod.pattern),e._zod.parse=(e,r)=>t.innerType._zod.run(e,r)}),nV=t2("$ZodNullable",(e,t)=>{nr.init(e,t),rr(e._zod,"optin",()=>t.innerType._zod.optin),rr(e._zod,"optout",()=>t.innerType._zod.optout),rr(e._zod,"pattern",()=>{let e=t.innerType._zod.pattern;return e?RegExp(`^(${re(e.source)}|null)$`):void 0}),rr(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(e,r)=>null===e.value?e:t.innerType._zod.run(e,r)}),nJ=t2("$ZodDefault",(e,t)=>{nr.init(e,t),e._zod.optin="optional",rr(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{if("backward"===r.direction)return t.innerType._zod.run(e,r);if(void 0===e.value)return e.value=t.defaultValue,e;let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(e=>nH(e,t)):nH(n,t)}});function nH(e,t){return void 0===e.value&&(e.value=t.defaultValue),e}let nK=t2("$ZodPrefault",(e,t)=>{nr.init(e,t),e._zod.optin="optional",rr(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>("backward"===r.direction||void 0===e.value&&(e.value=t.defaultValue),t.innerType._zod.run(e,r))}),nY=t2("$ZodNonOptional",(e,t)=>{nr.init(e,t),rr(e._zod,"values",()=>{let e=t.innerType._zod.values;return e?new Set([...e].filter(e=>void 0!==e)):void 0}),e._zod.parse=(r,n)=>{let i=t.innerType._zod.run(r,n);return i instanceof Promise?i.then(t=>nX(t,e)):nX(i,e)}});function nX(e,t){return e.issues.length||void 0!==e.value||e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}let nQ=t2("$ZodCatch",(e,t)=>{nr.init(e,t),rr(e._zod,"optin",()=>t.innerType._zod.optin),rr(e._zod,"optout",()=>t.innerType._zod.optout),rr(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(e,r)=>{if("backward"===r.direction)return t.innerType._zod.run(e,r);let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(n=>(e.value=n.value,n.issues.length&&(e.value=t.catchValue({...e,error:{issues:n.issues.map(e=>ry(e,r,t6))},input:e.value}),e.issues=[]),e)):(e.value=n.value,n.issues.length&&(e.value=t.catchValue({...e,error:{issues:n.issues.map(e=>ry(e,r,t6))},input:e.value}),e.issues=[]),e)}}),n0=t2("$ZodPipe",(e,t)=>{nr.init(e,t),rr(e._zod,"values",()=>t.in._zod.values),rr(e._zod,"optin",()=>t.in._zod.optin),rr(e._zod,"optout",()=>t.out._zod.optout),rr(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(e,r)=>{if("backward"===r.direction){let n=t.out._zod.run(e,r);return n instanceof Promise?n.then(e=>n1(e,t.in,r)):n1(n,t.in,r)}let n=t.in._zod.run(e,r);return n instanceof Promise?n.then(e=>n1(e,t.out,r)):n1(n,t.out,r)}});function n1(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}let n4=t2("$ZodReadonly",(e,t)=>{nr.init(e,t),rr(e._zod,"propValues",()=>t.innerType._zod.propValues),rr(e._zod,"values",()=>t.innerType._zod.values),rr(e._zod,"optin",()=>t.innerType?._zod?.optin),rr(e._zod,"optout",()=>t.innerType?._zod?.optout),e._zod.parse=(e,r)=>{if("backward"===r.direction)return t.innerType._zod.run(e,r);let n=t.innerType._zod.run(e,r);return n instanceof Promise?n.then(n2):n2(n)}});function n2(e){return e.value=Object.freeze(e.value),e}let n3=t2("$ZodCustom",(e,t)=>{rX.init(e,t),nr.init(e,t),e._zod.parse=(e,t)=>e,e._zod.check=r=>{let n=r.value,i=t.fn(n);if(i instanceof Promise)return i.then(t=>n9(t,r,n,e));n9(i,r,n,e)}});function n9(e,t,r,n){if(!e){let e={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(e.params=n._zod.def.params),t.issues.push(rb(e))}}(er=globalThis).__zod_globalRegistry??(er.__zod_globalRegistry=new class e{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){let r=t[0];return this._map.set(e,r),r&&"object"==typeof r&&"id"in r&&this._idmap.set(r.id,e),this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(e){let t=this._map.get(e);return t&&"object"==typeof t&&"id"in t&&this._idmap.delete(t.id),this._map.delete(e),this}get(e){let t=e._zod.parent;if(t){let r={...this.get(t)??{}};delete r.id;let n={...r,...this._map.get(e)};return Object.keys(n).length?n:void 0}return this._map.get(e)}has(e){return this._map.has(e)}});let n6=globalThis.__zod_globalRegistry;function n5(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...rp(t)})}function n8(e,t){return new rQ({check:"max_length",...rp(t),maximum:e})}function n7(e,t){return new r0({check:"min_length",...rp(t),minimum:e})}function ie(e,t){return new r1({check:"length_equals",...rp(t),length:e})}function it(e){return new r7({check:"overwrite",tx:e})}function ir(e){let t=e?.target??"draft-2020-12";return"draft-4"===t&&(t="draft-04"),"draft-7"===t&&(t="draft-07"),{processors:e.processors??{},metadataRegistry:e?.metadata??n6,target:t,unrepresentable:e?.unrepresentable??"throw",override:e?.override??(()=>{}),io:e?.io??"output",counter:0,seen:new Map,cycles:e?.cycles??"ref",reused:e?.reused??"inline",external:e?.external??void 0}}function ii(e,t,r={path:[],schemaPath:[]}){var n;let i=e._zod.def,a=t.seen.get(e);if(a)return a.count++,r.schemaPath.includes(e)&&(a.cycle=r.path),a.schema;let s={schema:{},count:1,cycle:void 0,path:r.path};t.seen.set(e,s);let o=e._zod.toJSONSchema?.();if(o)s.schema=o;else{let n={...r,schemaPath:[...r.schemaPath,e],path:r.path};if(e._zod.processJSONSchema)e._zod.processJSONSchema(t,s.schema,n);else{let r=s.schema,a=t.processors[i.type];if(!a)throw Error(`[toJSONSchema]: Non-representable type encountered: ${i.type}`);a(e,t,r,n)}let a=e._zod.parent;a&&(s.ref||(s.ref=a),ii(a,t,n),t.seen.get(a).isParent=!0)}let c=t.metadataRegistry.get(e);return c&&Object.assign(s.schema,c),"input"===t.io&&function e(t,r){let n=r??{seen:new Set};if(n.seen.has(t))return!1;n.seen.add(t);let i=t._zod.def;if("transform"===i.type)return!0;if("array"===i.type)return e(i.element,n);if("set"===i.type)return e(i.valueType,n);if("lazy"===i.type)return e(i.getter(),n);if("promise"===i.type||"optional"===i.type||"nonoptional"===i.type||"nullable"===i.type||"readonly"===i.type||"default"===i.type||"prefault"===i.type)return e(i.innerType,n);if("intersection"===i.type)return e(i.left,n)||e(i.right,n);if("record"===i.type||"map"===i.type)return e(i.keyType,n)||e(i.valueType,n);if("pipe"===i.type)return e(i.in,n)||e(i.out,n);if("object"===i.type){for(let t in i.shape)if(e(i.shape[t],n))return!0;return!1}if("union"===i.type){for(let t of i.options)if(e(t,n))return!0;return!1}if("tuple"===i.type){for(let t of i.items)if(e(t,n))return!0;if(i.rest&&e(i.rest,n))return!0}return!1}(e)&&(delete s.schema.examples,delete s.schema.default),"input"===t.io&&s.schema._prefault&&((n=s.schema).default??(n.default=s.schema._prefault)),delete s.schema._prefault,t.seen.get(e).schema}function ia(e,t){let r=e.seen.get(t);if(!r)throw Error("Unprocessed schema. This is a bug in Zod.");let n=new Map;for(let t of e.seen.entries()){let r=e.metadataRegistry.get(t[0])?.id;if(r){let e=n.get(r);if(e&&e!==t[0])throw Error(`Duplicate schema id "${r}" detected during JSON Schema conversion. Two different schemas cannot share the same id when converted together.`);n.set(r,t[0])}}let i=t=>{if(t[1].schema.$ref)return;let n=t[1],{ref:i,defId:a}=(t=>{let n="draft-2020-12"===e.target?"$defs":"definitions";if(e.external){let r=e.external.registry.get(t[0])?.id,i=e.external.uri??(e=>e);if(r)return{ref:i(r)};let a=t[1].defId??t[1].schema.id??`schema${e.counter++}`;return t[1].defId=a,{defId:a,ref:`${i("__shared")}#/${n}/${a}`}}if(t[1]===r)return{ref:"#"};let i=`#/${n}/`,a=t[1].schema.id??`__schema${e.counter++}`;return{defId:a,ref:i+a}})(t);n.def={...n.schema},a&&(n.defId=a);let s=n.schema;for(let e in s)delete s[e];s.$ref=i};if("throw"===e.cycles)for(let t of e.seen.entries()){let e=t[1];if(e.cycle)throw Error(`Cycle detected: #/${e.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(let r of e.seen.entries()){let n=r[1];if(t===r[0]){i(r);continue}if(e.external){let n=e.external.registry.get(r[0])?.id;if(t!==r[0]&&n){i(r);continue}}if(e.metadataRegistry.get(r[0])?.id||n.cycle||n.count>1&&"ref"===e.reused){i(r);continue}}}function is(e,t){let r=e.seen.get(t);if(!r)throw Error("Unprocessed schema. This is a bug in Zod.");let n=t=>{let r=e.seen.get(t);if(null===r.ref)return;let i=r.def??r.schema,a={...i},s=r.ref;if(r.ref=null,s){n(s);let r=e.seen.get(s),o=r.schema;if(o.$ref&&("draft-07"===e.target||"draft-04"===e.target||"openapi-3.0"===e.target)?(i.allOf=i.allOf??[],i.allOf.push(o)):Object.assign(i,o),Object.assign(i,a),t._zod.parent===s)for(let e in i)"$ref"!==e&&"allOf"!==e&&(e in a||delete i[e]);if(o.$ref&&r.def)for(let e in i)"$ref"!==e&&"allOf"!==e&&e in r.def&&JSON.stringify(i[e])===JSON.stringify(r.def[e])&&delete i[e]}let o=t._zod.parent;if(o&&o!==s){n(o);let t=e.seen.get(o);if(t?.schema.$ref&&(i.$ref=t.schema.$ref,t.def))for(let e in i)"$ref"!==e&&"allOf"!==e&&e in t.def&&JSON.stringify(i[e])===JSON.stringify(t.def[e])&&delete i[e]}e.override({zodSchema:t,jsonSchema:i,path:r.path??[]})};for(let t of[...e.seen.entries()].reverse())n(t[0]);let i={};if("draft-2020-12"===e.target?i.$schema="https://json-schema.org/draft/2020-12/schema":"draft-07"===e.target?i.$schema="http://json-schema.org/draft-07/schema#":"draft-04"===e.target?i.$schema="http://json-schema.org/draft-04/schema#":e.target,e.external?.uri){let r=e.external.registry.get(t)?.id;if(!r)throw Error("Schema is missing an `id` property");i.$id=e.external.uri(r)}Object.assign(i,r.def??r.schema);let a=e.external?.defs??{};for(let t of e.seen.entries()){let e=t[1];e.def&&e.defId&&(a[e.defId]=e.def)}e.external||Object.keys(a).length>0&&("draft-2020-12"===e.target?i.$defs=a:i.definitions=a);try{let r=JSON.parse(JSON.stringify(i));return Object.defineProperty(r,"~standard",{value:{...t["~standard"],jsonSchema:{input:io(t,"input",e.processors),output:io(t,"output",e.processors)}},enumerable:!1,writable:!1}),r}catch(e){throw Error("Error converting schema to JSON.")}}let io=(e,t,r={})=>n=>{let{libraryOptions:i,target:a}=n??{},s=ir({...i??{},target:a,io:t,processors:r});return ii(e,s),ia(s,e),is(s,e)},ic={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},il=(e,t,r,n)=>{let i=e._zod.def;ii(i.innerType,t,n),t.seen.get(e).ref=i.innerType},iu=t2("ZodISODateTime",(e,t)=>{nm.init(e,t),iD.init(e,t)}),id=t2("ZodISODate",(e,t)=>{nv.init(e,t),iD.init(e,t)}),ih=t2("ZodISOTime",(e,t)=>{ny.init(e,t),iD.init(e,t)}),ip=t2("ZodISODuration",(e,t)=>{n_.init(e,t),iD.init(e,t)}),ig=t2("ZodError",(e,t)=>{rS.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:t=>(function(e,t=e=>e.message){let r={_errors:[]},n=e=>{for(let i of e.issues)if("invalid_union"===i.code&&i.errors.length)i.errors.map(e=>n({issues:e}));else if("invalid_key"===i.code)n({issues:i.issues});else if("invalid_element"===i.code)n({issues:i.issues});else if(0===i.path.length)r._errors.push(t(i));else{let e=r,n=0;for(;n<i.path.length;){let r=i.path[n];n===i.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(i))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return n(e),r})(e,t)},flatten:{value:t=>(function(e,t=e=>e.message){let r={},n=[];for(let i of e.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(t(i))):n.push(t(i));return{formErrors:n,fieldErrors:r}})(e,t)},addIssue:{value:t=>{e.issues.push(t),e.message=JSON.stringify(e.issues,t8,2)}},addIssues:{value:t=>{e.issues.push(...t),e.message=JSON.stringify(e.issues,t8,2)}},isEmpty:{get:()=>0===e.issues.length}})},{Parent:Error}),im=rx(ig),iv=rz(ig),iy=rE(ig),i_=rT(ig),ib=(e,t,r)=>{let n=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return rx(ig)(e,t,n)},iw=(e,t,r)=>rx(ig)(e,t,r),iS=async(e,t,r)=>{let n=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return rz(ig)(e,t,n)},ik=async(e,t,r)=>rz(ig)(e,t,r),ix=(e,t,r)=>{let n=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return rE(ig)(e,t,n)},iz=(e,t,r)=>rE(ig)(e,t,r),iE=async(e,t,r)=>{let n=r?Object.assign(r,{direction:"backward"}):{direction:"backward"};return rT(ig)(e,t,n)},iI=async(e,t,r)=>rT(ig)(e,t,r),iT=t2("ZodType",(e,t)=>(nr.init(e,t),Object.assign(e["~standard"],{jsonSchema:{input:io(e,"input"),output:io(e,"output")}}),e.toJSONSchema=((e,t={})=>r=>{let n=ir({...r,processors:t});return ii(e,n),ia(n,e),is(n,e)})(e,{}),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(ri(t,{checks:[...t.checks??[],...r.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),{parent:!0}),e.with=e.check,e.clone=(t,r)=>rf(e,t,r),e.brand=()=>e,e.register=(t,r)=>(t.add(e,r),e),e.parse=(t,r)=>im(e,t,r,{callee:e.parse}),e.safeParse=(t,r)=>iy(e,t,r),e.parseAsync=async(t,r)=>iv(e,t,r,{callee:e.parseAsync}),e.safeParseAsync=async(t,r)=>i_(e,t,r),e.spa=e.safeParseAsync,e.encode=(t,r)=>ib(e,t,r),e.decode=(t,r)=>iw(e,t,r),e.encodeAsync=async(t,r)=>iS(e,t,r),e.decodeAsync=async(t,r)=>ik(e,t,r),e.safeEncode=(t,r)=>ix(e,t,r),e.safeDecode=(t,r)=>iz(e,t,r),e.safeEncodeAsync=async(t,r)=>iE(e,t,r),e.safeDecodeAsync=async(t,r)=>iI(e,t,r),e.refine=(t,r)=>e.check(function(e,t={}){return new al({type:"custom",check:"custom",fn:e,...rp(t)})}(t,r)),e.superRefine=t=>e.check(function(e){var t;let r,n;return t=t=>(t.addIssue=e=>{"string"==typeof e?t.issues.push(rb(e,t.value,r._zod.def)):(e.fatal&&(e.continue=!1),e.code??(e.code="custom"),e.input??(e.input=t.value),e.inst??(e.inst=r),e.continue??(e.continue=!r._zod.def.abort),t.issues.push(rb(e)))},e(t.value,t)),(n=new rX({check:"custom",...rp(void 0)}))._zod.check=t,r=n}(t)),e.overwrite=t=>e.check(it(t)),e.optional=()=>i8(e),e.exactOptional=()=>new i7({type:"optional",innerType:e}),e.nullable=()=>at(e),e.nullish=()=>i8(at(e)),e.nonoptional=t=>new ai({type:"nonoptional",innerType:e,...rp(t)}),e.array=()=>(function(e){return new i1({type:"array",element:e,...rp(void 0)})})(e),e.or=t=>new i2({type:"union",options:[e,t],...rp(void 0)}),e.and=t=>new i3({type:"intersection",left:e,right:t}),e.transform=t=>ao(e,new i6({type:"transform",transform:t})),e.default=t=>{var r,n;return r=e,n=t,new ar({type:"default",innerType:r,get defaultValue(){return"function"==typeof n?n():ru(n)}})},e.prefault=t=>{var r,n;return r=e,n=t,new an({type:"prefault",innerType:r,get defaultValue(){return"function"==typeof n?n():ru(n)}})},e.catch=t=>{var r;return new aa({type:"catch",innerType:e,catchValue:"function"==typeof(r=t)?r:()=>r})},e.pipe=t=>ao(e,t),e.readonly=()=>new ac({type:"readonly",innerType:e}),e.describe=t=>{let r=e.clone();return n6.add(r,{description:t}),r},Object.defineProperty(e,"description",{get:()=>n6.get(e)?.description,configurable:!0}),e.meta=(...t)=>{if(0===t.length)return n6.get(e);let r=e.clone();return n6.add(r,t[0]),r},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e.apply=t=>t(e),e)),iO=t2("_ZodString",(e,t)=>{nn.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r)=>{r.type="string";let{minimum:n,maximum:i,format:a,patterns:s,contentEncoding:o}=e._zod.bag;if("number"==typeof n&&(r.minLength=n),"number"==typeof i&&(r.maxLength=i),a&&(r.format=ic[a]??a,""===r.format&&delete r.format,"time"===a&&delete r.format),o&&(r.contentEncoding=o),s&&s.size>0){let e=[...s];1===e.length?r.pattern=e[0].source:e.length>1&&(r.allOf=[...e.map(e=>({..."draft-07"===t.target||"draft-04"===t.target||"openapi-3.0"===t.target?{type:"string"}:{},pattern:e.source}))])}})(e,t,r);let r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...t)=>e.check(function(e,t){return new r2({check:"string_format",format:"regex",...rp(t),pattern:e})}(...t)),e.includes=(...t)=>e.check(function(e,t){return new r6({check:"string_format",format:"includes",...rp(t),includes:e})}(...t)),e.startsWith=(...t)=>e.check(function(e,t){return new r5({check:"string_format",format:"starts_with",...rp(t),prefix:e})}(...t)),e.endsWith=(...t)=>e.check(function(e,t){return new r8({check:"string_format",format:"ends_with",...rp(t),suffix:e})}(...t)),e.min=(...t)=>e.check(n7(...t)),e.max=(...t)=>e.check(n8(...t)),e.length=(...t)=>e.check(ie(...t)),e.nonempty=(...t)=>e.check(n7(1,...t)),e.lowercase=t=>e.check(new r3({check:"string_format",format:"lowercase",...rp(t)})),e.uppercase=t=>e.check(new r9({check:"string_format",format:"uppercase",...rp(t)})),e.trim=()=>e.check(it(e=>e.trim())),e.normalize=(...t)=>e.check(function(e){return it(t=>t.normalize(e))}(...t)),e.toLowerCase=()=>e.check(it(e=>e.toLowerCase())),e.toUpperCase=()=>e.check(it(e=>e.toUpperCase())),e.slugify=()=>e.check(it(e=>e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")))}),iA=t2("ZodString",(e,t)=>{nn.init(e,t),iO.init(e,t),e.email=t=>e.check(new iP({type:"string",format:"email",check:"string_format",abort:!1,...rp(t)})),e.url=t=>e.check(new ij({type:"string",format:"url",check:"string_format",abort:!1,...rp(t)})),e.jwt=t=>e.check(new iY({type:"string",format:"jwt",check:"string_format",abort:!1,...rp(t)})),e.emoji=t=>e.check(new iR({type:"string",format:"emoji",check:"string_format",abort:!1,...rp(t)})),e.guid=t=>e.check(n5(iC,t)),e.uuid=t=>e.check(new iN({type:"string",format:"uuid",check:"string_format",abort:!1,...rp(t)})),e.uuidv4=t=>e.check(new iN({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...rp(t)})),e.uuidv6=t=>e.check(new iN({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...rp(t)})),e.uuidv7=t=>e.check(new iN({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...rp(t)})),e.nanoid=t=>e.check(new iU({type:"string",format:"nanoid",check:"string_format",abort:!1,...rp(t)})),e.guid=t=>e.check(n5(iC,t)),e.cuid=t=>e.check(new iM({type:"string",format:"cuid",check:"string_format",abort:!1,...rp(t)})),e.cuid2=t=>e.check(new iL({type:"string",format:"cuid2",check:"string_format",abort:!1,...rp(t)})),e.ulid=t=>e.check(new iB({type:"string",format:"ulid",check:"string_format",abort:!1,...rp(t)})),e.base64=t=>e.check(new iJ({type:"string",format:"base64",check:"string_format",abort:!1,...rp(t)})),e.base64url=t=>e.check(new iH({type:"string",format:"base64url",check:"string_format",abort:!1,...rp(t)})),e.xid=t=>e.check(new iZ({type:"string",format:"xid",check:"string_format",abort:!1,...rp(t)})),e.ksuid=t=>e.check(new iF({type:"string",format:"ksuid",check:"string_format",abort:!1,...rp(t)})),e.ipv4=t=>e.check(new iW({type:"string",format:"ipv4",check:"string_format",abort:!1,...rp(t)})),e.ipv6=t=>e.check(new iq({type:"string",format:"ipv6",check:"string_format",abort:!1,...rp(t)})),e.cidrv4=t=>e.check(new iG({type:"string",format:"cidrv4",check:"string_format",abort:!1,...rp(t)})),e.cidrv6=t=>e.check(new iV({type:"string",format:"cidrv6",check:"string_format",abort:!1,...rp(t)})),e.e164=t=>e.check(new iK({type:"string",format:"e164",check:"string_format",abort:!1,...rp(t)})),e.datetime=t=>e.check(new iu({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...rp(t)})),e.date=t=>e.check(new id({type:"string",format:"date",check:"string_format",...rp(t)})),e.time=t=>e.check(new ih({type:"string",format:"time",check:"string_format",precision:null,...rp(t)})),e.duration=t=>e.check(new ip({type:"string",format:"duration",check:"string_format",...rp(t)}))});function i$(e){return new iA({type:"string",...rp(e)})}let iD=t2("ZodStringFormat",(e,t)=>{ni.init(e,t),iO.init(e,t)}),iP=t2("ZodEmail",(e,t)=>{no.init(e,t),iD.init(e,t)}),iC=t2("ZodGUID",(e,t)=>{na.init(e,t),iD.init(e,t)}),iN=t2("ZodUUID",(e,t)=>{ns.init(e,t),iD.init(e,t)}),ij=t2("ZodURL",(e,t)=>{nc.init(e,t),iD.init(e,t)}),iR=t2("ZodEmoji",(e,t)=>{nl.init(e,t),iD.init(e,t)}),iU=t2("ZodNanoID",(e,t)=>{nu.init(e,t),iD.init(e,t)}),iM=t2("ZodCUID",(e,t)=>{nd.init(e,t),iD.init(e,t)}),iL=t2("ZodCUID2",(e,t)=>{nh.init(e,t),iD.init(e,t)}),iB=t2("ZodULID",(e,t)=>{nf.init(e,t),iD.init(e,t)}),iZ=t2("ZodXID",(e,t)=>{np.init(e,t),iD.init(e,t)}),iF=t2("ZodKSUID",(e,t)=>{ng.init(e,t),iD.init(e,t)}),iW=t2("ZodIPv4",(e,t)=>{nb.init(e,t),iD.init(e,t)}),iq=t2("ZodIPv6",(e,t)=>{nw.init(e,t),iD.init(e,t)}),iG=t2("ZodCIDRv4",(e,t)=>{nS.init(e,t),iD.init(e,t)}),iV=t2("ZodCIDRv6",(e,t)=>{nk.init(e,t),iD.init(e,t)}),iJ=t2("ZodBase64",(e,t)=>{nz.init(e,t),iD.init(e,t)}),iH=t2("ZodBase64URL",(e,t)=>{nE.init(e,t),iD.init(e,t)}),iK=t2("ZodE164",(e,t)=>{nI.init(e,t),iD.init(e,t)}),iY=t2("ZodJWT",(e,t)=>{nT.init(e,t),iD.init(e,t)}),iX=t2("ZodUnknown",(e,t)=>{nO.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(e,t,r)=>void 0});function iQ(){return new iX({type:"unknown"})}let i0=t2("ZodNever",(e,t)=>{nA.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(e,t,r)=>{t.not={}}}),i1=t2("ZodArray",(e,t)=>{nD.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{let i=e._zod.def,{minimum:a,maximum:s}=e._zod.bag;"number"==typeof a&&(r.minItems=a),"number"==typeof s&&(r.maxItems=s),r.type="array",r.items=ii(i.element,t,{...n,path:[...n.path,"items"]})})(e,t,r,n),e.element=t.element,e.min=(t,r)=>e.check(n7(t,r)),e.nonempty=t=>e.check(n7(1,t)),e.max=(t,r)=>e.check(n8(t,r)),e.length=(t,r)=>e.check(ie(t,r)),e.unwrap=()=>e.element}),i4=t2("ZodObject",(e,t)=>{nR.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{let i=e._zod.def;r.type="object",r.properties={};let a=i.shape;for(let e in a)r.properties[e]=ii(a[e],t,{...n,path:[...n.path,"properties",e]});let s=new Set([...new Set(Object.keys(a))].filter(e=>{let r=i.shape[e]._zod;return"input"===t.io?void 0===r.optin:void 0===r.optout}));s.size>0&&(r.required=Array.from(s)),i.catchall?._zod.def.type==="never"?r.additionalProperties=!1:i.catchall?i.catchall&&(r.additionalProperties=ii(i.catchall,t,{...n,path:[...n.path,"additionalProperties"]})):"output"===t.io&&(r.additionalProperties=!1)})(e,t,r,n),rr(e,"shape",()=>t.shape),e.keyof=()=>{var t;return new i9({type:"enum",entries:Array.isArray(t=Object.keys(e._zod.def.shape))?Object.fromEntries(t.map(e=>[e,e])):t,...rp(void 0)})},e.catchall=t=>e.clone({...e._zod.def,catchall:t}),e.passthrough=()=>e.clone({...e._zod.def,catchall:iQ()}),e.loose=()=>e.clone({...e._zod.def,catchall:iQ()}),e.strict=()=>e.clone({...e._zod.def,catchall:new i0({type:"never",...rp(void 0)})}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=t=>(function(e,t){if(!rl(t))throw Error("Invalid input to extend: expected a plain object");let r=e._zod.def.checks;if(r&&r.length>0){let r=e._zod.def.shape;for(let e in t)if(void 0!==Object.getOwnPropertyDescriptor(r,e))throw Error("Cannot overwrite keys on object schemas containing refinements. Use `.safeExtend()` instead.")}let n=ri(e._zod.def,{get shape(){let r={...e._zod.def.shape,...t};return rn(this,"shape",r),r}});return rf(e,n)})(e,t),e.safeExtend=t=>(function(e,t){if(!rl(t))throw Error("Invalid input to safeExtend: expected a plain object");let r=ri(e._zod.def,{get shape(){let r={...e._zod.def.shape,...t};return rn(this,"shape",r),r}});return rf(e,r)})(e,t),e.merge=t=>{let r;return r=ri(e._zod.def,{get shape(){let r={...e._zod.def.shape,...t._zod.def.shape};return rn(this,"shape",r),r},get catchall(){return t._zod.def.catchall},checks:[]}),rf(e,r)},e.pick=t=>(function(e,t){let r=e._zod.def,n=r.checks;if(n&&n.length>0)throw Error(".pick() cannot be used on object schemas containing refinements");let i=ri(e._zod.def,{get shape(){let e={};for(let n in t){if(!(n in r.shape))throw Error(`Unrecognized key: "${n}"`);t[n]&&(e[n]=r.shape[n])}return rn(this,"shape",e),e},checks:[]});return rf(e,i)})(e,t),e.omit=t=>(function(e,t){let r=e._zod.def,n=r.checks;if(n&&n.length>0)throw Error(".omit() cannot be used on object schemas containing refinements");let i=ri(e._zod.def,{get shape(){let n={...e._zod.def.shape};for(let e in t){if(!(e in r.shape))throw Error(`Unrecognized key: "${e}"`);t[e]&&delete n[e]}return rn(this,"shape",n),n},checks:[]});return rf(e,i)})(e,t),e.partial=(...t)=>(function(e,t,r){let n=t._zod.def.checks;if(n&&n.length>0)throw Error(".partial() cannot be used on object schemas containing refinements");let i=ri(t._zod.def,{get shape(){let n=t._zod.def.shape,i={...n};if(r)for(let t in r){if(!(t in n))throw Error(`Unrecognized key: "${t}"`);r[t]&&(i[t]=e?new e({type:"optional",innerType:n[t]}):n[t])}else for(let t in n)i[t]=e?new e({type:"optional",innerType:n[t]}):n[t];return rn(this,"shape",i),i},checks:[]});return rf(t,i)})(i5,e,t[0]),e.required=(...t)=>{var r;let n;return r=t[0],n=ri(e._zod.def,{get shape(){let t=e._zod.def.shape,n={...t};if(r)for(let e in r){if(!(e in n))throw Error(`Unrecognized key: "${e}"`);r[e]&&(n[e]=new ai({type:"nonoptional",innerType:t[e]}))}else for(let e in t)n[e]=new ai({type:"nonoptional",innerType:t[e]});return rn(this,"shape",n),n}}),rf(e,n)}}),i2=t2("ZodUnion",(e,t)=>{nM.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>{let i,a,s;return a=!1===(i=e._zod.def).inclusive,s=i.options.map((e,r)=>ii(e,t,{...n,path:[...n.path,a?"oneOf":"anyOf",r]})),void(a?r.oneOf=s:r.anyOf=s)},e.options=t.options}),i3=t2("ZodIntersection",(e,t)=>{nL.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>{let i,a,s,o;return a=ii((i=e._zod.def).left,t,{...n,path:[...n.path,"allOf",0]}),s=ii(i.right,t,{...n,path:[...n.path,"allOf",1]}),void(r.allOf=[...(o=e=>"allOf"in e&&1===Object.keys(e).length)(a)?a.allOf:[a],...o(s)?s.allOf:[s]])}}),i9=t2("ZodEnum",(e,t)=>{nZ.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>{let i;(i=t5(e._zod.def.entries)).every(e=>"number"==typeof e)&&(r.type="number"),i.every(e=>"string"==typeof e)&&(r.type="string"),r.enum=i},e.enum=t.entries,e.options=Object.values(t.entries);let r=new Set(Object.keys(t.entries));e.extract=(e,n)=>{let i={};for(let n of e)if(r.has(n))i[n]=t.entries[n];else throw Error(`Key ${n} not found in enum`);return new i9({...t,checks:[],...rp(n),entries:i})},e.exclude=(e,n)=>{let i={...t.entries};for(let t of e)if(r.has(t))delete i[t];else throw Error(`Key ${t} not found in enum`);return new i9({...t,checks:[],...rp(n),entries:i})}}),i6=t2("ZodTransform",(e,t)=>{nF.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(e,t,r)=>(e=>{if("throw"===e.unrepresentable)throw Error("Transforms cannot be represented in JSON Schema")})(e),e._zod.parse=(r,n)=>{if("backward"===n.direction)throw new t9(e.constructor.name);r.addIssue=n=>{"string"==typeof n?r.issues.push(rb(n,r.value,t)):(n.fatal&&(n.continue=!1),n.code??(n.code="custom"),n.input??(n.input=r.value),n.inst??(n.inst=e),r.issues.push(rb(n)))};let i=t.transform(r.value,r);return i instanceof Promise?i.then(e=>(r.value=e,r)):(r.value=i,r)}}),i5=t2("ZodOptional",(e,t)=>{nq.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>il(e,t,r,n),e.unwrap=()=>e._zod.def.innerType});function i8(e){return new i5({type:"optional",innerType:e})}let i7=t2("ZodExactOptional",(e,t)=>{nG.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>il(e,t,r,n),e.unwrap=()=>e._zod.def.innerType}),ae=t2("ZodNullable",(e,t)=>{nV.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>{let i,a,s;return a=ii((i=e._zod.def).innerType,t,n),s=t.seen.get(e),void("openapi-3.0"===t.target?(s.ref=i.innerType,r.nullable=!0):r.anyOf=[a,{type:"null"}])},e.unwrap=()=>e._zod.def.innerType});function at(e){return new ae({type:"nullable",innerType:e})}let ar=t2("ZodDefault",(e,t)=>{nJ.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>{let i;ii((i=e._zod.def).innerType,t,n),t.seen.get(e).ref=i.innerType,r.default=JSON.parse(JSON.stringify(i.defaultValue))},e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap}),an=t2("ZodPrefault",(e,t)=>{nK.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>{let i;ii((i=e._zod.def).innerType,t,n),t.seen.get(e).ref=i.innerType,"input"===t.io&&(r._prefault=JSON.parse(JSON.stringify(i.defaultValue)))},e.unwrap=()=>e._zod.def.innerType}),ai=t2("ZodNonOptional",(e,t)=>{nY.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>{let i;ii((i=e._zod.def).innerType,t,n),t.seen.get(e).ref=i.innerType},e.unwrap=()=>e._zod.def.innerType}),aa=t2("ZodCatch",(e,t)=>{nQ.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>((e,t,r,n)=>{let i,a=e._zod.def;ii(a.innerType,t,n),t.seen.get(e).ref=a.innerType;try{i=a.catchValue(void 0)}catch{throw Error("Dynamic catch values are not supported in JSON Schema")}r.default=i})(e,t,r,n),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap}),as=t2("ZodPipe",(e,t)=>{n0.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>{let i,a;return i=e._zod.def,void(ii(a="input"===t.io?"transform"===i.in._zod.def.type?i.out:i.in:i.out,t,n),t.seen.get(e).ref=a)},e.in=t.in,e.out=t.out});function ao(e,t){return new as({type:"pipe",in:e,out:t})}let ac=t2("ZodReadonly",(e,t)=>{n4.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(t,r,n)=>{let i;ii((i=e._zod.def).innerType,t,n),t.seen.get(e).ref=i.innerType,r.readOnly=!0},e.unwrap=()=>e._zod.def.innerType}),al=t2("ZodCustom",(e,t)=>{n3.init(e,t),iT.init(e,t),e._zod.processJSONSchema=(e,t,r)=>(e=>{if("throw"===e.unrepresentable)throw Error("Custom types cannot be represented in JSON Schema")})(e)}),au=new i4({type:"object",shape:{ltoken_v2:i$().min(1),ltuid_v2:i$().min(1),ltmid_v2:i$().min(1),cookie_token_v2:i$().optional(),account_mid_v2:i$().optional(),account_id_v2:i$().optional()}??{},...rp(void 0)});function ad(e){return au.safeParse(e).success}let ah="abcdefghijklmnopqrstuvwxyz0123456789",af="https://bbs-api-os.hoyolab.com",ap="https://sg-public-api.hoyolab.com",ag={"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",Accept:"application/json, text/plain, */*","Accept-Language":"en-US,en;q=0.9","x-rpc-app_version":"1.5.0","x-rpc-client_type":"5","x-rpc-language":"en-us",Origin:"https://act.hoyolab.com",Referer:"https://act.hoyolab.com/"},am="/game_record/genshin/api/dailyNote",av="/game_record/genshin/api/spiralAbyss",ay="/event/game_record/genshin/api/act_calendar",a_="/game_record/hkrpg/api/note",ab="/game_record/hkrpg/api/get_act_calender",aw="/event/game_record_zzz/api/zzz/note",aS="/event/game_record_zzz/api/zzz/gacha_calendar";class ak extends Error{retcode;constructor(e,t){super(t),this.retcode=e,this.name="HoyolabApiError"}}let ax={gi:{id:"gi",name:"Genshin Impact",staminaMax:200,staminaField:"current_resin",staminaName:"Resin",dailyNoteEndpoint:"/game_record/genshin/api/dailyNote",checkInActId:"e202102251931481",checkInBaseUrl:"https://sg-hk4e-api.hoyolab.com",checkInPath:"/event/sol",signGameHeader:"hk4e",regions:{1:"cn_gf01",2:"cn_gf01",5:"cn_qd01",6:"os_usa",7:"os_euro",8:"os_asia",9:"os_cht"}},hsr:{id:"hsr",name:"Honkai: Star Rail",staminaMax:300,staminaField:"current_stamina",staminaName:"Trailblaze Power",dailyNoteEndpoint:"/game_record/hkrpg/api/note",checkInActId:"e202303301540311",checkInBaseUrl:"https://sg-public-api.hoyolab.com",checkInPath:"/event/luna/hkrpg/os",signGameHeader:"hkrpg",regions:{1:"prod_gf_cn",2:"prod_gf_cn",5:"prod_qd_cn",6:"prod_official_usa",7:"prod_official_eur",8:"prod_official_asia",9:"prod_official_cht"}},zzz:{id:"zzz",name:"Zenless Zone Zero",staminaMax:240,staminaField:"energy",staminaName:"Battery",dailyNoteEndpoint:"/event/game_record_zzz/api/zzz/note",checkInActId:"e202406031448091",checkInBaseUrl:"https://sg-public-api.hoyolab.com",checkInPath:"/event/luna/zzz/os",signGameHeader:"zzz",regions:{10:"prod_gf_us",13:"prod_gf_jp",15:"prod_gf_eu",17:"prod_gf_sg"}}};function az(e,t){let r=ax[t],n=e.charAt(0);if("zzz"===t){let t=e.substring(0,2),n=r.regions[t];if(n)return n}let i=r.regions[n];return i||(Object.values(r.regions)[0]??"os_usa")}class aE{auth;cookieString;constructor(e){this.auth=e,this.cookieString=`ltoken_v2=${e.ltoken_v2}; ltuid_v2=${e.ltuid_v2}; ltmid_v2=${e.ltmid_v2}`}async request(e,t,r={}){var n;let i,a,s,{method:o="GET",query:c,body:l,useDS:u=!0}=r,d=`${e}${t}`;if(c){let e=new URLSearchParams(c);d+=`?${e.toString()}`}let h={...ag,Cookie:this.cookieString,...r.headers};u&&(i=Math.floor(Date.now()/1e3),a=function(){let e="";for(let t=0;t<6;t++)e+=ah.charAt(Math.floor(Math.random()*ah.length));return e}(),n=`salt=6s25p5ox5y14umn1p61aqyyvbvvl3lrt&t=${i}&r=${a}`,s=eW.createHash("md5").update(n).digest("hex"),h.DS=`${i},${a},${s}`),l&&(h["Content-Type"]="application/json");let f=await fetch(d,{method:o,headers:h,body:l?JSON.stringify(l):void 0});if(!f.ok)throw Error(`HTTP ${f.status}: ${f.statusText}`);let p=await f.json();if(0!==p.retcode)throw new ak(p.retcode,p.message);return p.data}async getGenshinDailyNote(e){let t=az(e,"gi");return this.request(af,am,{query:{role_id:e,server:t}})}async getGenshinSpiralAbyss(e,t=1){let r=az(e,"gi");return this.request(af,av,{query:{role_id:e,server:r,schedule_type:String(t)}})}async getCheckInInfo(e){let t=ax[e];return this.request(t.checkInBaseUrl,`${t.checkInPath}/info`,{query:{act_id:t.checkInActId,lang:"en-us"},useDS:!1,headers:{"x-rpc-signgame":t.signGameHeader}})}async getCheckInRewards(e){let t=ax[e];return this.request(t.checkInBaseUrl,`${t.checkInPath}/home`,{query:{act_id:t.checkInActId,lang:"en-us"},useDS:!1,headers:{"x-rpc-signgame":t.signGameHeader}})}async claimCheckIn(e){let t=ax[e];return this.request(t.checkInBaseUrl,`${t.checkInPath}/sign`,{method:"POST",query:{act_id:t.checkInActId,lang:"en-us"},useDS:!1,headers:{"x-rpc-signgame":t.signGameHeader}})}async getGenshinActCalendar(e){let t=az(e,"gi");return this.request(ap,ay,{method:"POST",query:{role_id:e,server:t},useDS:!1})}async getStarRailDailyNote(e){let t=az(e,"hsr");return this.request(af,a_,{query:{role_id:e,server:t}})}async getStarRailActCalendar(e){let t=az(e,"hsr");return this.request(af,ab,{query:{role_id:e,server:t}})}async getZZZDailyNote(e){let t=az(e,"zzz");return this.request(ap,aw,{query:{role_id:e,server:t}})}async getZZZGachaCalendar(e){let t=az(e,"zzz");return this.request(ap,aS,{query:{uid:e,region:t}})}}async function aI(e){let t=e.pendingValidation;if(!t)return;let r=e.accounts??{},n=r[t];if(!n)return void await t4.settings.setGlobalSettings({...e,pendingValidation:void 0});let i="invalid";if(ad(n.auth))try{let e=new aE(n.auth);await e.getCheckInInfo("gi"),i="valid"}catch{i="invalid"}let a={...r,[t]:{...n,authStatus:i}};await t4.settings.setGlobalSettings({...e,accounts:a,pendingValidation:void 0})}class aT{async fetchAll(e,t,r){let n=new Map,i=[...this.getFetchers(e,t).entries()].filter(([e])=>r.includes(e)),a=await Promise.allSettled(i.map(async([e,t])=>({type:e,data:await t()})));for(let e=0;e<a.length;e++){let t=a[e],r=i[e][0];"fulfilled"===t.status?n.set(t.value.type,{status:"ok",data:t.value.data,fetchedAt:Date.now()}):(t4.logger.warn(`[${this.game}] Failed to fetch ${r}:`,t.reason),n.set(r,{status:"error",error:t.reason instanceof Error?t.reason:Error(String(t.reason)),fetchedAt:Date.now()}))}return n}}class aO extends aT{game="gi";getFetchers(e,t){return new Map([["gi:daily-note",()=>e.getGenshinDailyNote(t)],["gi:spiral-abyss",()=>e.getGenshinSpiralAbyss(t)],["gi:act-calendar",()=>e.getGenshinActCalendar(t)],["gi:check-in",async()=>{let[t,r]=await Promise.all([e.getCheckInInfo("gi"),e.getCheckInRewards("gi")]);return{info:t,rewards:r}}]])}}class aA extends aT{game="hsr";getFetchers(e,t){return new Map([["hsr:daily-note",()=>e.getStarRailDailyNote(t)],["hsr:act-calendar",()=>e.getStarRailActCalendar(t)],["hsr:check-in",async()=>{let[t,r]=await Promise.all([e.getCheckInInfo("hsr"),e.getCheckInRewards("hsr")]);return{info:t,rewards:r}}]])}}class a$ extends aT{game="zzz";getFetchers(e,t){return new Map([["zzz:daily-note",()=>e.getZZZDailyNote(t)],["zzz:gacha-calendar",()=>e.getZZZGachaCalendar(t)],["zzz:check-in",async()=>{let[t,r]=await Promise.all([e.getCheckInInfo("zzz"),e.getCheckInRewards("zzz")]);return{info:t,rewards:r}}]])}}class aD{pollIntervalMs=3e5;gameControllers={gi:new aO,hsr:new aA,zzz:new a$};store=new Map;clientCache=new Map;registrations=new Map;pollTimer=null;polling=!1;previousAccounts;previousDisableAnimations=!1;settingsDebounceTimer=null;static SETTINGS_DEBOUNCE_MS=500;isAnimationDisabled(){return this.previousDisableAnimations}init(){t4.settings.getGlobalSettings().then(e=>{this.previousDisableAnimations=e.disableAnimations??!1,this.previousAccounts=structuredClone(e.accounts??{})}),t4.settings.onDidReceiveGlobalSettings(e=>{this.settingsDebounceTimer&&clearTimeout(this.settingsDebounceTimer);let t=e.settings;this.settingsDebounceTimer=setTimeout(()=>{this.settingsDebounceTimer=null,this.onGlobalSettingsChanged(t)},aD.SETTINGS_DEBOUNCE_MS)})}register(e){let t=this.registrations.get(e.actionId);if(!(t&&t.accountId===e.accountId&&t.dataTypes.length===e.dataTypes.length&&t.dataTypes.every((t,r)=>t===e.dataTypes[r]))){for(let t of(this.registrations.set(e.actionId,e),t4.logger.debug(`[DataController] Registered ${e.actionId} for ${e.dataTypes.join(", ")}`),e.dataTypes)){let r=this.buildStoreKey(e.accountId,t),n=this.store.get(r);if(n)try{e.listener({accountId:e.accountId,dataType:t,entry:n})}catch(t){t4.logger.error(`[DataController] Listener error on register push for ${e.actionId}:`,t)}}this.startPollingIfNeeded()}}unregister(e){this.registrations.delete(e),t4.logger.debug(`[DataController] Unregistered ${e}`),0===this.registrations.size&&this.stopPolling()}getRegistration(e){return this.registrations.get(e)}getData(e,t){let r=this.buildStoreKey(e,t);return this.store.get(r)}async requestUpdate(e,t){let r=this.getActiveDataTypes(e,t);0!==r.length&&await this.fetchAndNotify(e,t,r)}getClient(e){if(!ad(e.auth))return null;let t=this.clientCache.get(e.id);if(t)return t;let r=new aE(e.auth);return this.clientCache.set(e.id,r),r}invalidateAccount(e){for(let t of(this.clientCache.delete(e),[...this.store.keys()]))t.startsWith(`${e}:`)&&this.store.delete(t);t4.logger.debug(`[DataController] Invalidated account ${e}`)}invalidateAll(){this.clientCache.clear(),this.store.clear(),t4.logger.debug("[DataController] Invalidated all data")}setPollingInterval(e){this.pollIntervalMs=e,this.pollTimer&&(this.stopPolling(),this.startPollingIfNeeded())}onGlobalSettingsChanged(e){let t=e.accounts??{},r=this.previousAccounts??{};for(let e of(this.previousAccounts=structuredClone(t),Object.keys(r)))e in t||(t4.logger.debug(`[DataController] Account ${e} deleted, invalidating`),this.invalidateAccount(e));for(let[e,n]of Object.entries(t)){let t=r[e];t&&(this.authEqual(t.auth,n.auth)||(t4.logger.debug(`[DataController] Auth changed for account ${e}, invalidating`),this.invalidateAccount(e)))}let n=e.disableAnimations??!1;n!==this.previousDisableAnimations&&(this.previousDisableAnimations=n,this.renotifyAll())}authEqual(e,t){return e.ltoken_v2===t.ltoken_v2&&e.ltuid_v2===t.ltuid_v2&&e.ltmid_v2===t.ltmid_v2&&e.cookie_token_v2===t.cookie_token_v2&&e.account_mid_v2===t.account_mid_v2&&e.account_id_v2===t.account_id_v2}renotifyAll(){for(let e of this.registrations.values())for(let t of e.dataTypes){let r=this.buildStoreKey(e.accountId,t),n=this.store.get(r);if(n)try{e.listener({accountId:e.accountId,dataType:t,entry:n})}catch(t){t4.logger.error(`[DataController] Listener error on renotify for ${e.actionId}:`,t)}}}startPollingIfNeeded(){this.pollTimer||0!==this.registrations.size&&(t4.logger.info(`[DataController] Starting polling (interval: ${this.pollIntervalMs}ms)`),this.pollTimer=setInterval(()=>{this.pollTick()},this.pollIntervalMs))}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null,t4.logger.info("[DataController] Stopped polling"))}async pollTick(){if(this.polling)return void t4.logger.debug("[DataController] Poll tick skipped (already running)");this.polling=!0;try{let e=this.getActiveAccountGames(),t=[];for(let[r,n]of e)for(let e of n){let n=this.getActiveDataTypes(r,e);n.length>0&&t.push(this.fetchAndNotify(r,e,n))}await Promise.allSettled(t)}finally{this.polling=!1}}getActiveAccountGames(){let e=new Map;for(let t of this.registrations.values()){let r=e.get(t.accountId);for(let n of(r||(r=new Set,e.set(t.accountId,r)),t.dataTypes)){let e=n.split(":")[0];r.add(e)}}return e}getActiveDataTypes(e,t){let r=new Set;for(let n of this.registrations.values())if(n.accountId===e)for(let e of n.dataTypes)e.startsWith(`${t}:`)&&r.add(e);return[...r]}async fetchAndNotify(e,t,r){let n=await this.resolveAccount(e);if(!n)return void t4.logger.warn(`[DataController] Account ${e} not found, skipping fetch`);let i=this.getClient(n);if(!i)return void t4.logger.warn(`[DataController] Invalid auth for account ${e}, skipping fetch`);let a=n.uids[t];if(!a)return void t4.logger.debug(`[DataController] No UID for ${t} on account ${e}, skipping`);let s=this.gameControllers[t];for(let[t,n]of(await s.fetchAll(i,a,r))){let r=this.buildStoreKey(e,t);this.store.set(r,n),this.notifyListeners(e,t,n)}}notifyListeners(e,t,r){for(let n of this.registrations.values())if(n.accountId===e&&n.dataTypes.includes(t))try{n.listener({accountId:e,dataType:t,entry:r})}catch(e){t4.logger.error(`[DataController] Listener error for ${n.actionId}:`,e)}}async resolveAccount(e){let t=await t4.settings.getGlobalSettings();return t.accounts?.[e]??null}buildStoreKey(e,t){return`${e}:${t}`}}let aP=new aD;class aC extends t1{async getGlobalSettings(){return await t4.settings.getGlobalSettings()}getResolvedGame(e){return this.game}async resolveAccount(e,t){let r=(await this.getGlobalSettings()).accounts??{},n=e.accountId;if(n)return r[n]??null;let i=e.uid;if(i)return Object.values(r).find(e=>Object.values(e.uids).includes(i))??null;let a=this.getResolvedGame(e),s=Object.values(r).filter(e=>void 0!==e.uids[a]);if(1===s.length){let r=s[0];return t&&await t.setSettings({...e,accountId:r.id}),r}return null}getClientForAccount(e){return aP.getClient(e)}async getAccountContext(e,t){let r=await this.resolveAccount(e,t);if(!r)return null;let n=this.getClientForAccount(r);return n?{account:r,client:n}:null}getGameUid(e,t){return e.uids[t]??null}async showNoAccount(e){await e.setTitle("Select\nAccount"),await e.showAlert()}async showNoAuth(e){await e.setTitle("Setup\nAuth"),await e.showAlert()}async showNoUid(e){await e.setTitle("Set\nUID"),await e.showAlert()}async showError(e,t){await e.setTitle(t??"Error"),await e.showAlert()}async withErrorHandling(e,t){try{await t()}catch(t){(t4.logger.error("Action error:",t),t instanceof ak?-101!==t.retcode&&10001!==t.retcode:1)?(t instanceof ak?-110!==t.retcode:1)?await this.showError(e):await this.showError(e,"Rate\nLimited"):await this.showNoAuth(e)}}async onWillAppear(e){if(!e.action.isKey())return;let t=e.action,r=await this.resolveAccount(e.payload.settings,t);if(!r)return void await this.showNoAccount(t);let n=this.getResolvedGame(e.payload.settings);this.getGameUid(r,n)?(aP.register({actionId:e.action.id,accountId:r.id,dataTypes:this.getSubscribedDataTypes(e.payload.settings),listener:e=>{this.withErrorHandling(t,()=>this.onDataUpdate(t,e))}}),await this.withErrorHandling(t,async()=>{await aP.requestUpdate(r.id,n)})):await this.showNoUid(t)}onWillDisappear(e){aP.unregister(e.action.id)}async onDidReceiveSettings(e){if(!e.action.isKey())return;let t=e.action,r=await this.resolveAccount(e.payload.settings);if(!r){aP.unregister(e.action.id),await this.showNoAccount(t);return}let n=this.getResolvedGame(e.payload.settings);if(!this.getGameUid(r,n)){aP.unregister(e.action.id),await this.showNoUid(t);return}let i=this.getSubscribedDataTypes(e.payload.settings),a=aP.getRegistration(e.action.id);a&&a.accountId===r.id&&a.dataTypes.length===i.length&&a.dataTypes.every((e,t)=>e===i[t])||(aP.unregister(e.action.id),aP.register({actionId:e.action.id,accountId:r.id,dataTypes:i,listener:e=>{this.withErrorHandling(t,()=>this.onDataUpdate(t,e))}}),await this.withErrorHandling(t,async()=>{await aP.requestUpdate(r.id,n)}))}async onSendToPlugin(e){if(e.action.isKey()&&"refresh"===e.payload.event){let t=e.action,r=await t.getSettings(),n=await this.resolveAccount(r);if(!n)return;let i=this.getResolvedGame(r);await aP.requestUpdate(n.id,i)}}async onKeyDown(e){let t=await this.resolveAccount(e.payload.settings);if(!t)return;let r=this.getResolvedGame(e.payload.settings);await this.withErrorHandling(e.action,async()=>{await aP.requestUpdate(t.id,r)})}}class aN{cache=new Map;get(e){let t=this.cache.get(e);if(t)return Date.now()>t.expires?void this.cache.delete(e):t.value}set(e,t,r){this.cache.set(e,{value:t,expires:Date.now()+r})}has(e){return void 0!==this.get(e)}delete(e){this.cache.delete(e)}clear(){this.cache.clear()}get size(){return this.cache.size}prune(){let e=Date.now();for(let[t,r]of this.cache)e>r.expires&&this.cache.delete(t)}}let aj=new aN,aR=eQ.resolve(eQ.dirname(__filename),".."),aU=e=>{let t=`local-image:${e}`,r=aj.get(t);if(r)return r;let n=eQ.resolve(aR,e),i=eX.readFileSync(n).toString("base64"),a=`data:image/png;base64,${i}`;return aj.set(t,a,36e5),a},aM=async e=>{let t=`image:${e}`,r=aj.get(t);if(r)return r;let n=await fetch(e);if(!n.ok)throw Error(`Failed to fetch image: HTTP ${n.status}`);let i=Buffer.from(await n.arrayBuffer()).toString("base64"),a=n.headers.get("content-type")??"image/png",s=`data:${a};base64,${i}`;return aj.set(t,s,36e5),s},aL={gi:aU("imgs/actions/gi/5-star.webp"),hsr:aU("imgs/actions/hsr/5-star.png"),zzz:aU("imgs/actions/zzz/5-star.png")},aB=e=>{if(e<=0)return"Ended";let t=Math.floor(e/86400),r=Math.floor(e%86400/3600);return t>0?`${t}d ${r}h`:`${r}h`},aZ={position:"center",layout:"horizontal",fontSize:18},aF=e=>({charWidth:.65*e,badgeHeight:Math.round(1.55*e)}),aW=(e,t,r)=>{let n,{charWidth:i,badgeHeight:a}=aF(r),s=Math.round(e.length*i+20);switch(t){case"left":n=6;break;case"right":n=144-s-6;break;default:n=Math.round((144-s)/2)}let o=144-a-6,c=n+s/2,l=o+a/2+r/3;return`<rect x="${n}" y="${o}" width="${s}" height="${a}" rx="10" fill="black" opacity="0.7" />
  <text x="${c}" y="${l}" font-family="sans-serif" font-size="${r}" font-weight="bold" fill="white" text-anchor="middle">${e}</text>`},aq=144-aF(18).badgeHeight-6,aG=(e,t,r,n)=>{let{position:i,layout:a,fontSize:s}=n??aZ,o="vertical"===a?((e,t,r)=>{let{charWidth:n,badgeHeight:i}=aF(r),a=Math.round(e.length*n+20);return`<g transform="translate(${"right"===t?138-i/2:6+i/2}, 72) rotate(-90)">
    <rect x="${-(a/2)}" y="${-(i/2)}" width="${a}" height="${i}" rx="10" fill="black" opacity="0.7" />
    <text x="0" y="${r/3}" font-family="sans-serif" font-size="${r}" font-weight="bold" fill="white" text-anchor="middle">${e}</text>
  </g>`})(t,i,s):aW(t,i,s);return`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144" viewBox="0 0 144 144">
  <image href="${aL[r]}" x="0" y="0" width="144" height="144" preserveAspectRatio="xMidYMid slice" />
  <image href="${e}" x="0" y="${"gi"===r?0:-12}" width="144" height="${"gi"===r?144:169}" preserveAspectRatio="xMidYMid slice" />
  ${o}
</svg>`},aV=e=>Math.round(10*e)/10,aJ=Array.from({length:48},(e,t)=>{let r=t/48*Math.PI*2;return{x:aV(.5*Math.cos(1.5*r)),y:aV(5*Math.sin(r)),r:aV(+Math.sin(r+Math.PI/4))}}),aH=(e,t,r,n,i,a=1)=>{let s=aJ[r%aJ.length],o=Math.round(144*(1-Math.min(Math.max(n/i,0),1))),c=aW(`${n}`,"center",18),l=144*a,u=(144-l)/2,d=u+s.x,h=u+s.y,f=u+l/2+s.x,p=u+l/2+s.y;return`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144" viewBox="0 0 144 144">
  <image href="${e}" x="0" y="0" width="144" height="144" preserveAspectRatio="xMidYMid slice" />
  <image href="${t}" x="${d}" y="${h}" width="${l}" height="${l}" preserveAspectRatio="xMidYMid meet" transform="rotate(${s.r}, ${f}, ${p})" />
  <rect x="0" y="0" width="144" height="${o}" fill="black" opacity="0.6" />
  ${c}
</svg>`};function aK(e,t,r,n){return(aK=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}en=t0({UUID:"com.fcannizzaro.hoyodeck.genshin.resin"});class aY extends(ea=aC){static{({c:[t,ei]}=aK(this,[],[en],ea))}game="gi";MAX_RESIN=ax.gi.staminaMax;animationInterval=null;frameIndex=0;clearAnimation(){null!==this.animationInterval&&(clearInterval(this.animationInterval),this.animationInterval=null,this.frameIndex=0)}startAnimation(e,t){let r=aU("imgs/actions/gi/3-star.webp"),n=aU("imgs/actions/gi/resin.webp"),i=async()=>{let i=aH(r,n,this.frameIndex,t,this.MAX_RESIN),a=`data:image/svg+xml;base64,${btoa(i)}`;await e.setImage(a),this.frameIndex=(this.frameIndex+1)%aJ.length};i(),aP.isAnimationDisabled()||(this.animationInterval=setInterval(()=>{i()},200))}getSubscribedDataTypes(){return["gi:daily-note"]}async onDataUpdate(e,t){if(this.clearAnimation(),"error"===t.entry.status)return void await this.showError(e);let r=t.entry.data;await e.setTitle(""),this.startAnimation(e,r.current_resin)}onWillDisappear(e){super.onWillDisappear(e),this.clearAnimation()}static{ei()}}let aX=Array.from({length:30},(e,t)=>({x:Math.round(2*Math.sin(t/30*Math.PI*2)*10)/10,blink:t>=12&&t<=15}));function aQ(e,t,r,n){return(aQ=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}let a0=aU("imgs/actions/gi/commissions-bg.png"),a1={unfinished:{background:a0,open:aU("imgs/actions/gi/commissions-unfinished-open.png"),closed:aU("imgs/actions/gi/commissions-unfinished-closed.png")},completed:{background:a0,open:aU("imgs/actions/gi/commissions-completed-open.png"),closed:aU("imgs/actions/gi/commissions-completed-closed.png")},rewarded:{background:a0,open:aU("imgs/actions/gi/commissions-rewarded-open.png"),closed:aU("imgs/actions/gi/commissions-rewarded-closed.png")}};es=t0({UUID:"com.fcannizzaro.hoyodeck.genshin.commission"});class a4 extends(ec=aC){static{({c:[r,eo]}=aQ(this,[],[es],ec))}game="gi";animationInterval=null;frameIndex=0;clearAnimation(){null!==this.animationInterval&&(clearInterval(this.animationInterval),this.animationInterval=null,this.frameIndex=0)}startAnimation(e,t,r){let n=async()=>{var n,i,a;let s,o,c,l=(n=t,i=this.frameIndex,a=r,o=(s=aX[i%aX.length]).blink?n.closed:n.open,c=void 0!==a?aW(a,"center",18):"",`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144" viewBox="0 0 144 144">
  <image href="${n.background}" x="0" y="0" width="144" height="144" preserveAspectRatio="xMidYMid slice" />
  <image href="${o}" x="${s.x}" y="0" width="144" height="144" preserveAspectRatio="xMidYMid meet" />
  ${c}
</svg>`),u=`data:image/svg+xml;base64,${btoa(l)}`;await e.setImage(u),this.frameIndex=this.frameIndex+1};n(),aP.isAnimationDisabled()||(this.animationInterval=setInterval(()=>{n()},100))}getSubscribedDataTypes(){return["gi:daily-note"]}async onDataUpdate(e,t){if(this.clearAnimation(),"error"===t.entry.status)return void await this.showError(e);let r=t.entry.data,n=r.daily_task.attendance_rewards.filter(e=>"AttendanceRewardStatusWaitTaken"===e.status).length,i=r.finished_task_num+n>=r.total_task_num,a=r.is_extra_task_reward_received?a1.rewarded:i?a1.completed:a1.unfinished,s=i?void 0:`${r.finished_task_num}/${r.total_task_num}`;await e.setTitle(""),this.startAnimation(e,a,s)}onWillDisappear(e){super.onWillDisappear(e),this.clearAnimation()}static{eo()}}let a2="#6B4226";function a3(e,t,r,n){return(a3=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}let a9=aU("imgs/actions/gi/expeditions-state.png");el=t0({UUID:"com.fcannizzaro.hoyodeck.genshin.expedition"});class a6 extends(ed=aC){static{({c:[n,eu]}=a3(this,[],[el],ed))}game="gi";animationInterval=null;lastRefreshTime=0;expeditionData=[];totalExpeditions=0;clearAnimation(){null!==this.animationInterval&&(clearInterval(this.animationInterval),this.animationInterval=null)}startCountdown(e){let t=async()=>{let t=(Date.now()-this.lastRefreshTime)/1e3,r=((e,t,r)=>{let n=Math.min(t.length,5),i=t.filter(e=>e.finished).length;if(0===n)return`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144" viewBox="0 0 144 144">
  <image href="${e}" x="0" y="0" width="144" height="144" preserveAspectRatio="xMidYMid slice" />
</svg>`;let{positions:a,radius:s}=(e=>{if(e<=3){let t=Math.round(aq/2),r=144/(e+1);return{positions:Array.from({length:e},(e,n)=>({cx:Math.round(r*(n+1)),cy:t})),radius:28}}let t=Math.ceil(e/2),r=e-t,n=Math.round(aq/3),i=Math.round(2*aq/3),a=144/(t+1),s=144/(r+1),o=[];for(let e=0;e<t;e++)o.push({cx:Math.round(a*(e+1)),cy:n});for(let e=0;e<r;e++)o.push({cx:Math.round(s*(e+1)),cy:i});return{positions:o,radius:24}})(n),o=a.map((e,t)=>`<clipPath id="c${t}"><circle cx="${e.cx}" cy="${e.cy}" r="${s}" /></clipPath>`).join("\n    "),c=Math.round(2*s*1.1),l=c/2,u=t.map((e,t)=>{let{cx:r,cy:n}=a[t],i=`<circle cx="${r}" cy="${n}" r="${s}" fill="${a2}" />`,o=`<image href="${e.avatarDataUri}" x="${r-l}" y="${n-l}" width="${c}" height="${c}" clip-path="url(#c${t})" preserveAspectRatio="xMidYMid slice" />`,u=`<circle cx="${r}" cy="${n}" r="${s+1}" fill="none" stroke="${a2}" stroke-width="2" />`;return`${i}
  ${o}
  ${u}`}).join("\n  "),d=aW(`${i} / ${r}`,"center",18);return`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144" viewBox="0 0 144 144">
  <image href="${e}" x="0" y="0" width="144" height="144" preserveAspectRatio="xMidYMid slice" />
  <defs>
    ${o}
  </defs>
  ${u}
  ${d}
</svg>`})(a9,this.expeditionData.slice(0,5).map(e=>{let r=Math.max(0,e.remainingSeconds-t);return{...e,remainingSeconds:r,finished:e.finished||r<=0}}),this.totalExpeditions),n=`data:image/svg+xml;base64,${btoa(r)}`;await e.setImage(n)};t(),aP.isAnimationDisabled()||(this.animationInterval=setInterval(()=>{t()},3e4))}getSubscribedDataTypes(){return["gi:daily-note"]}async onDataUpdate(e,t){if(this.clearAnimation(),"error"===t.entry.status)return void await this.showError(e);let r=t.entry.data,n=await Promise.all(r.expeditions.map(e=>aM(e.avatar_side_icon)));this.lastRefreshTime=Date.now(),this.totalExpeditions=r.current_expedition_num,this.expeditionData=r.expeditions.map((e,t)=>({avatarDataUri:n[t],finished:"Finished"===e.status,remainingSeconds:parseInt(e.remained_time,10)||0})),await e.setTitle(""),this.startCountdown(e)}onWillDisappear(e){super.onWillDisappear(e),this.clearAnimation()}static{eu()}}let a5=e=>Math.round(10*e)/10,a8=Array.from({length:48},(e,t)=>{let r=t/48*Math.PI*2;return{x:a5(.5*Math.cos(1.5*r)),y:a5(5*Math.sin(r)),r:a5(+Math.sin(r+Math.PI/4))}});function a7(e,t,r,n){return(a7=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}let se=aU("imgs/actions/gi/tubby.png"),st=aU("imgs/actions/gi/tubby-max.png"),sr=aU("imgs/actions/gi/5-star.webp");eh=t0({UUID:"com.fcannizzaro.hoyodeck.genshin.teapot"});class sn extends(ep=aC){static{({c:[i,ef]}=a7(this,[],[eh],ep))}game="gi";animationInterval=null;frameIndex=0;clearAnimation(){null!==this.animationInterval&&(clearInterval(this.animationInterval),this.animationInterval=null,this.frameIndex=0)}startAnimation(e,t,r){let n=async()=>{var n,i,a,s,o;let c,l,u=(n=sr,i=r?st:se,a=this.frameIndex,s=t,o=r,c=a8[a%a8.length],l=aW(s,"center",18),`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144" viewBox="0 0 144 144">
  <image href="${n}" x="0" y="0" width="144" height="144" preserveAspectRatio="xMidYMid slice" />
  ${o?'<rect x="0" y="0" width="144" height="144" fill="red" style="opacity: 0.3" />':""}
  <image href="${i}" x="${.5+c.x}" y="${1.5+c.y}" width="143" height="161" preserveAspectRatio="xMidYMid meet" transform="rotate(${c.r}, ${72+c.x}, ${72+c.y})" />
  ${l}
</svg>`),d=`data:image/svg+xml;base64,${btoa(u)}`;await e.setImage(d),this.frameIndex=this.frameIndex+1};n(),aP.isAnimationDisabled()||(this.animationInterval=setInterval(()=>{n()},200))}getSubscribedDataTypes(){return["gi:daily-note"]}async onDataUpdate(e,t){if(this.clearAnimation(),"error"===t.entry.status)return void await this.showError(e);let r=t.entry.data,n=r.max_home_coin===r.current_home_coin,i=Math.round(r.current_home_coin/r.max_home_coin*100),a=n?"MAX COIN!":`${i}%`;await e.setTitle(""),this.startAnimation(e,a,n)}onWillDisappear(e){super.onWillDisappear(e),this.clearAnimation()}static{ef()}}function si(e,t,r,n){return(si=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}eg=t0({UUID:"com.fcannizzaro.hoyodeck.genshin.transformer"});class sa extends(ev=aC){static{({c:[a,em]}=si(this,[],[eg],ev))}game="gi";getSubscribedDataTypes(){return["gi:daily-note"]}async onDataUpdate(e,t){var r;if("error"===t.entry.status)return void await this.showError(e);let n=t.entry.data;if(!n.transformer.obtained)return void await e.setTitle("N/A");let i=+!!n.transformer.recovery_time.reached,a=(r=n.transformer.recovery_time).reached?"Ready":r.Day>0?`${r.Day}d ${r.Hour}h`:r.Hour>0?`${r.Hour}h ${r.Minute}m`:`${r.Minute}m`;await e.setTitle(i?"":a),await e.setState(i)}static{em()}}function ss(e,t,r,n){return(ss=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}ey=t0({UUID:"com.fcannizzaro.hoyodeck.genshin.abyss"});class so extends(eb=aC){static{({c:[s,e_]}=ss(this,[],[ey],eb))}game="gi";getSubscribedDataTypes(){return["gi:spiral-abyss"]}async onDataUpdate(e,t){var r;let n,i;if("error"===t.entry.status)return void await this.showError(e);let a=t.entry.data,s=(r=new Date(1e3*parseInt(a.end_time)),n=new Date,(i=Math.ceil((r.getTime()-n.getTime())/864e5))<=0?"Ended":1===i?"1 day":`${i} days`);await e.setTitle(`${a.total_star}*
${s}`)}static{e_()}}function sc(e,t,r,n){return(sc=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}ew=t0({UUID:"com.fcannizzaro.hoyodeck.genshin.daily-reward"});class sl extends(ek=aC){static{({c:[o,eS]}=sc(this,[],[ew],ek))}game="gi";getResolvedGame(e){return e.game??"gi"}getSubscribedDataTypes(e){let t=e.game??"gi";return[`${t}:check-in`]}async onDataUpdate(e,t){var r;let n;if("error"===t.entry.status)return void await this.showError(e);let i=t.entry.data,a=(await e.getSettings()).game??"gi",{info:s,rewards:o}=i,c=s.total_sign_day-!!s.is_sign,l=o.awards[c];if(!l)return void await e.setTitle("--");let u=await aM(l.icon),d=aU(`imgs/actions/${a}/daily.png`),h=aU(`imgs/actions/${a}/done.png`),f=(n=(r=s.is_sign)?`<image href="${h}" x="0" y="0" width="144" height="144" preserveAspectRatio="xMidYMid slice" />`:"",`<svg xmlns="http://www.w3.org/2000/svg" width="144" height="144" viewBox="0 0 144 144">
  <image href="${d}" x="0" y="0" width="144" height="144" preserveAspectRatio="xMidYMid slice" />
  <image href="${u}" x="32" y="32" width="80" height="80" preserveAspectRatio="xMidYMid meet" style="opacity: ${r?"0.6":"1"}" />
  ${n}
</svg>`),p=`data:image/svg+xml;base64,${btoa(f)}`;await e.setTitle(""),await e.setImage(p)}async onKeyDown(e){await this.withErrorHandling(e.action,async()=>{let t=await this.getAccountContext(e.payload.settings,e.action);if(!t)return void await this.showNoAccount(e.action);let r=e.payload.settings.game??"gi",n=aP.getData(t.account.id,`${r}:check-in`);if(n?.status==="ok"&&n.data.info.is_sign)return void await e.action.showOk();if(e.payload.settings.claimOnClick??!0)try{await t.client.claimCheckIn(r),await e.action.showOk()}catch(t){if(t instanceof ak&&-5003===t.retcode)await e.action.showOk();else throw t}await aP.requestUpdate(t.account.id,r)})}static{eS()}}function su(e,t,r,n){return(su=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}function sd(e,t,r,n){return(sd=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}ex=t0({UUID:"com.fcannizzaro.hoyodeck.genshin.banner"}),(class extends(eE=aC){static{({c:[c,ez]}=su(this,[],[ex],eE))}game="gi";bannerIndex=0;currentAccountId=null;getSubscribedDataTypes(){return["gi:act-calendar"]}async onKeyDown(e){if(this.bannerIndex++,this.currentAccountId){let t=aP.getData(this.currentAccountId,"gi:act-calendar");if(t?.status==="ok"){let r=e.payload.settings;await this.withErrorHandling(e.action,async()=>{await this.renderCalendar(e.action,r,t.data)});return}}let t=await this.resolveAccount(e.payload.settings);t&&await this.withErrorHandling(e.action,async()=>{await aP.requestUpdate(t.id,"gi")})}async onDataUpdate(e,t){if("error"===t.entry.status)return void await this.showError(e);this.currentAccountId=t.accountId;let r=await e.getSettings();await this.renderCalendar(e,r,t.entry.data)}async renderCalendar(e,t,r){let n=t.type??"character",i=await this.getGlobalSettings(),a={position:i.bannerBadgePosition??"center",layout:i.bannerBadgeLayout??"horizontal",fontSize:i.bannerBadgeFontSize??18};"character"===n?await this.displayCharacterBanner(e,r.avatar_card_pool_list,a):await this.displayWeaponBanner(e,r.weapon_card_pool_list,a)}getActiveBanners(e){let t=Math.floor(Date.now()/1e3);return e.filter(e=>{let r=Number(e.start_timestamp),n=Number(e.end_timestamp);return t>r&&t<n})}async displayCharacterBanner(e,t,r){if(0===t.length)return void await e.setTitle("No\nBanner");let n=this.getActiveBanners(t).flatMap(e=>e.avatars.filter(e=>5===e.rarity).map(t=>({icon:t.icon,countdown_seconds:e.countdown_seconds}))),i=this.bannerIndex%n.length,a=n[i];if(a){let t=aB(a.countdown_seconds),n=aG(await aM(a.icon),t,"gi",r),i=`data:image/svg+xml;base64,${btoa(n)}`;await e.setTitle(""),await e.setImage(i)}}async displayWeaponBanner(e,t,r){if(0===t.length)return void await e.setTitle("No\nBanner");let n=this.getActiveBanners(t).flatMap(e=>e.weapon.filter(e=>5===e.rarity).map(t=>({icon:t.icon,countdown_seconds:e.countdown_seconds}))),i=this.bannerIndex%n.length,a=n[i];if(a){let t=aB(a.countdown_seconds),n=aG(await aM(a.icon),t,"gi",r),i=`data:image/svg+xml;base64,${btoa(n)}`;await e.setTitle(""),await e.setImage(i)}}static{ez()}}),eI=t0({UUID:"com.fcannizzaro.hoyodeck.hsr.trailblaze-power"});class sh extends(eO=aC){static{({c:[l,eT]}=sd(this,[],[eI],eO))}game="hsr";MAX_STAMINA=ax.hsr.staminaMax;animationInterval=null;frameIndex=0;clearAnimation(){null!==this.animationInterval&&(clearInterval(this.animationInterval),this.animationInterval=null,this.frameIndex=0)}startAnimation(e,t){let r=aU("imgs/actions/hsr/trailblaze-power-state@2x.png"),n=aU("imgs/actions/hsr/trailblaze-power.webp"),i=async()=>{let i=aH(r,n,this.frameIndex,t,this.MAX_STAMINA),a=`data:image/svg+xml;base64,${btoa(i)}`;await e.setImage(a),this.frameIndex=(this.frameIndex+1)%aJ.length};i(),aP.isAnimationDisabled()||(this.animationInterval=setInterval(()=>{i()},200))}getSubscribedDataTypes(){return["hsr:daily-note"]}async onDataUpdate(e,t){if(this.clearAnimation(),"error"===t.entry.status)return void await this.showError(e);let r=t.entry.data;await e.setTitle(""),this.startAnimation(e,r.current_stamina)}onWillDisappear(e){super.onWillDisappear(e),this.clearAnimation()}static{eT()}}function sf(e,t,r,n){return(sf=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}function sp(e,t,r,n){return(sp=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}eA=t0({UUID:"com.fcannizzaro.hoyodeck.hsr.banner"}),(class extends(eD=aC){static{({c:[u,e$]}=sf(this,[],[eA],eD))}game="hsr";bannerIndex=0;currentAccountId=null;getSubscribedDataTypes(){return["hsr:act-calendar"]}getCountdownSeconds(e){return Math.max(Number(e.end_ts)-Math.floor(Date.now()/1e3),0)}async onKeyDown(e){let t=e.payload.settings;if("character"===(t.type??"character")&&this.bannerIndex++,this.currentAccountId){let r=aP.getData(this.currentAccountId,"hsr:act-calendar");if(r?.status==="ok")return void await this.withErrorHandling(e.action,async()=>{await this.renderCalendar(e.action,t,r.data)})}let r=await this.resolveAccount(t);r&&await this.withErrorHandling(e.action,async()=>{await aP.requestUpdate(r.id,"hsr")})}async onDataUpdate(e,t){if("error"===t.entry.status)return void await this.showError(e);this.currentAccountId=t.accountId;let r=await e.getSettings();await this.renderCalendar(e,r,t.entry.data)}async renderCalendar(e,t,r){let n=t.type??"character",i=await this.getGlobalSettings(),a={position:i.bannerBadgePosition??"center",layout:i.bannerBadgeLayout??"horizontal",fontSize:i.bannerBadgeFontSize??18};"character"===n?await this.displayCharacterBanner(e,r.avatar_card_pool_list,a):await this.displayEquipBanner(e,r.equip_card_pool_list,a)}getActiveBanners(e){return e.filter(e=>{let t=e.time_info.now;return t>e.time_info.start_ts&&t<e.time_info.end_ts})}async displayCharacterBanner(e,t,r){if(0===t.length)return void await e.setTitle("No\nBanner");let n=this.getActiveBanners(t).flatMap(e=>e.avatar_list.filter(e=>"5"===e.rarity).map(t=>({icon:t.icon_url,time_info:e.time_info}))),i=this.bannerIndex%n.length,a=n[i];if(a){let t=aB(this.getCountdownSeconds(a.time_info)),n=aG(await aM(a.icon),t,"hsr",r),i=`data:image/svg+xml;base64,${btoa(n)}`;await e.setTitle(""),await e.setImage(i)}}async displayEquipBanner(e,t,r){if(0===t.length)return void await e.setTitle("No\nBanner");let n=this.getActiveBanners(t).flatMap(e=>e.equip_list.filter(e=>"5"===e.rarity).map(t=>({icon:t.item_url,time_info:e.time_info}))),i=this.bannerIndex%n.length,a=n[i];if(a){let t=aB(this.getCountdownSeconds(a.time_info)),n=aG(await aM(a.icon),t,"hsr",r),i=`data:image/svg+xml;base64,${btoa(n)}`;await e.setTitle(""),await e.setImage(i)}}static{e$()}}),eP=t0({UUID:"com.fcannizzaro.hoyodeck.zzz.battery-charge"});class sg extends(eN=aC){static{({c:[d,eC]}=sp(this,[],[eP],eN))}game="zzz";MAX_BATTERY=ax.zzz.staminaMax;animationInterval=null;frameIndex=0;clearAnimation(){null!==this.animationInterval&&(clearInterval(this.animationInterval),this.animationInterval=null,this.frameIndex=0)}startAnimation(e,t){let r=aU("imgs/actions/zzz/battery-recharge-state@2x.png"),n=aU("imgs/actions/zzz/battery-recharge.png"),i=async()=>{let i=aH(r,n,this.frameIndex,t,this.MAX_BATTERY,.75),a=`data:image/svg+xml;base64,${btoa(i)}`;await e.setImage(a),this.frameIndex=(this.frameIndex+1)%aJ.length};i(),aP.isAnimationDisabled()||(this.animationInterval=setInterval(()=>{i()},200))}getSubscribedDataTypes(){return["zzz:daily-note"]}async onDataUpdate(e,t){if(this.clearAnimation(),"error"===t.entry.status)return void await this.showError(e);let r=t.entry.data;await e.setTitle(""),this.startAnimation(e,r.energy.progress.current)}onWillDisappear(e){super.onWillDisappear(e),this.clearAnimation()}static{eC()}}function sm(e,t,r,n){return(sm=function(){function e(e,t){return function(n){(function(e,t){if(e.v)throw Error("attempted to call "+t+" after decoration was finished")})(t,"addInitializer"),r(n,"An initializer"),e.push(n)}}function t(t,r,n,i,a,s,o,c,l){switch(a){case 1:u="accessor";break;case 2:u="method";break;case 3:u="getter";break;case 4:u="setter";break;default:u="field"}var u,d,h,f={kind:u,name:o?"#"+r:r,static:s,private:o,metadata:c},p={v:!1};f.addInitializer=e(i,p),0===a?o?(d=n.get,h=n.set):(d=function(){return this[r]},h=function(e){this[r]=e}):2===a?d=function(){return n.value}:((1===a||3===a)&&(d=function(){return n.get.call(this)}),(1===a||4===a)&&(h=function(e){n.set.call(this,e)})),f.access=d&&h?{get:d,set:h}:d?{get:d}:{set:h};try{return t(l,f)}finally{p.v=!0}}function r(e,t){if("function"!=typeof e)throw TypeError(t+" must be a function")}function n(e,t){var n=typeof t;if(1===e){if("object"!==n||null===t)throw TypeError("accessor decorators must return an object with get, set, or init properties or void 0");void 0!==t.get&&r(t.get,"accessor.get"),void 0!==t.set&&r(t.set,"accessor.set"),void 0!==t.init&&r(t.init,"accessor.init")}else if("function"!==n)throw TypeError((0===e?"field":10===e?"class":"method")+" decorators must return a function or void 0")}function i(e,t){t&&e.push(function(e){for(var r=0;r<t.length;r++)t[r].call(e);return e})}function a(e,t){return Object.defineProperty(e,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:t})}return function(r,s,o,c){if(void 0!==c)var l=c[Symbol.metadata||Symbol.for("Symbol.metadata")];var u=Object.create(void 0===l?null:l),d=function(e,r,a){for(var s=[],o=new Map,c=new Map,l=0;l<r.length;l++){var u,d,h,f,p=r[l];if(Array.isArray(p)){var g=p[1],m=p[2],v=p.length>3,y=g>=5;if(y?(h=e,g-=5,f=d=d||[]):(h=e.prototype,f=u=u||[]),0!==g&&!v){var _=y?c:o,b=_.get(m)||0;if(!0===b||3===b&&4!==g||4===b&&3!==g)throw Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+m);!b&&g>2?_.set(m,g):_.set(m,!0)}!function(e,r,i,a,s,o,c,l,u){var d,h,f,p,g,m,v=i[0];if(c?d=0===s||1===s?{get:i[3],set:i[4]}:3===s?{get:i[3]}:4===s?{set:i[3]}:{value:i[3]}:0!==s&&(d=Object.getOwnPropertyDescriptor(r,a)),1===s?f={get:d.get,set:d.set}:2===s?f=d.value:3===s?f=d.get:4===s&&(f=d.set),"function"==typeof v)void 0!==(p=t(v,a,d,l,s,o,c,u,f))&&(n(s,p),0===s?h=p:1===s?(h=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p);else for(var y=v.length-1;y>=0;y--)void 0!==(p=t(v[y],a,d,l,s,o,c,u,f))&&(n(s,p),0===s?m=p:1===s?(m=p.init,f={get:g=p.get||f.get,set:p.set||f.set}):f=p,void 0!==m&&(void 0===h?h=m:"function"==typeof h?h=[h,m]:h.push(m)));if(0===s||1===s){if(void 0===h)h=function(e,t){return t};else if("function"!=typeof h){var _=h;h=function(e,t){for(var r=t,n=0;n<_.length;n++)r=_[n].call(e,r);return r}}else{var b=h;h=function(e,t){return b.call(e,t)}}e.push(h)}0!==s&&(1===s?(d.get=f.get,d.set=f.set):2===s?d.value=f:3===s?d.get=f:4===s&&(d.set=f),c?1===s?(e.push(function(e,t){return f.get.call(e,t)}),e.push(function(e,t){return f.set.call(e,t)})):2===s?e.push(f):e.push(function(e,t){return f.call(e,t)}):Object.defineProperty(r,a,d))}(s,h,p,m,g,y,v,f,a)}}return i(s,u),i(s,d),s}(r,s,u);return o.length||a(r,u),{e:d,get c(){return function(t,r,i){if(r.length>0){for(var s=[],o=t,c=t.name,l=r.length-1;l>=0;l--){var u={v:!1};try{var d=r[l](o,{kind:"class",name:c,addInitializer:e(s,u),metadata:i})}finally{u.v=!0}void 0!==d&&(n(10,d),o=d)}return[a(o,i),function(){for(var e=0;e<s.length;e++)s[e].call(o)}]}}(r,o,u)}}}}())(e,t,r,n)}ej=t0({UUID:"com.fcannizzaro.hoyodeck.zzz.banner"});class sv extends(eU=aC){static{({c:[h,eR]}=sm(this,[],[ej],eU))}game="zzz";bannerIndex=0;currentAccountId=null;getSubscribedDataTypes(){return["zzz:gacha-calendar"]}async onKeyDown(e){let t=e.payload.settings;if("character"===(t.type??"character")&&this.bannerIndex++,this.currentAccountId){let r=aP.getData(this.currentAccountId,"zzz:gacha-calendar");if(r?.status==="ok")return void await this.withErrorHandling(e.action,async()=>{await this.renderCalendar(e.action,t,r.data)})}let r=await this.resolveAccount(t);r&&await this.withErrorHandling(e.action,async()=>{await aP.requestUpdate(r.id,"zzz")})}async onDataUpdate(e,t){if("error"===t.entry.status)return void await this.showError(e);this.currentAccountId=t.accountId;let r=await e.getSettings();await this.renderCalendar(e,r,t.entry.data)}async renderCalendar(e,t,r){let n=t.type??"character",i=await this.getGlobalSettings(),a={position:i.bannerBadgePosition??"center",layout:i.bannerBadgeLayout??"horizontal",fontSize:i.bannerBadgeFontSize??18};"character"===n?await this.displayCharacterBanner(e,r.avatar_gacha_schedule_list,a):await this.displayWeaponBanner(e,r.weapon_gacha_schedule_list,a)}getActiveEvents(e){return e.filter(e=>"GACHA_STATE_IN_PROGRESS"===e.gacha_state)}async displayCharacterBanner(e,t,r){let n=this.getActiveEvents(t).flatMap(e=>e.avatar_list.filter(e=>"S"===e.rarity).map(t=>({icon:t.icon,left_end_ts:e.left_end_ts})));if(0===n.length)return void await e.setTitle("No\nBanner");let i=this.bannerIndex%n.length,a=n[i];if(a){let t=aB(a.left_end_ts),n=aG(await aM(a.icon),t,"zzz",r),i=`data:image/svg+xml;base64,${btoa(n)}`;await e.setTitle(""),await e.setImage(i)}}async displayWeaponBanner(e,t,r){let n=this.getActiveEvents(t).flatMap(e=>e.weapon_list.filter(e=>"S"===e.rarity).map(t=>({icon:t.icon,left_end_ts:e.left_end_ts})));if(0===n.length)return void await e.setTitle("No\nBanner");let i=this.bannerIndex%n.length,a=n[i];if(a){let t=aB(a.left_end_ts),n=aG(await aM(a.icon),t,"zzz",r),i=`data:image/svg+xml;base64,${btoa(n)}`;await e.setTitle(""),await e.setImage(i)}}static{eR()}}t4.settings.onDidReceiveGlobalSettings(e=>{let t=e.settings;t.pendingValidation&&aI(t)}),aP.init(),t4.actions.registerAction(new t),t4.actions.registerAction(new r),t4.actions.registerAction(new n),t4.actions.registerAction(new i),t4.actions.registerAction(new a),t4.actions.registerAction(new s),t4.actions.registerAction(new o),t4.actions.registerAction(new c),t4.actions.registerAction(new l),t4.actions.registerAction(new u),t4.actions.registerAction(new d),t4.actions.registerAction(new h),t4.connect();
//# sourceMappingURL=plugin.js.map
